(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4837],{899:(e,t,s)=>{"use strict";s.d(t,{default:()=>o});var a=s(53400);let l=s(48276).memo(function(e){return(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 16 16",fill:"none",...e,children:[(0,a.jsx)("title",{children:"edit"}),(0,a.jsx)("path",{fill:"currentColor",d:"M14 14.67H2a.5.5 0 0 1-.5-.5c0-.28.23-.5.5-.5h12c.27 0 .5.22.5.5a.5.5 0 0 1-.5.5ZM12.68 2.32c-1.3-1.3-2.56-1.33-3.89 0l-.8.8a.28.28 0 0 0-.07.27 5.42 5.42 0 0 0 3.77 3.7c.07 0 .14-.02.19-.08l.8-.8c.66-.66.98-1.3.98-1.93 0-.66-.31-1.3-.98-1.96ZM10.4 7.69a7.4 7.4 0 0 1-1.35-.86 5.64 5.64 0 0 1-.8-.8c-.02 0-.06-.06-.1-.12-.07-.08-.18-.2-.28-.36a8.6 8.6 0 0 1-.6-1.03c-.1-.23-.39-.29-.56-.12L2.9 8.22a.8.8 0 0 0-.18.37l-.36 2.55c-.07.45.06.88.34 1.17a1.33 1.33 0 0 0 1.17.34l2.56-.36c.12-.02.29-.1.37-.19L10.6 8.3c.17-.18.1-.47-.12-.57a18.3 18.3 0 0 1-.07-.03Z"})]})});var n=s(61281),r=s(51093),i=s.n(r);function o(e){var t;let{momentId:s,userId:r}=e,o=(0,n.J)();return o.login&&(null==(t=o.detail)?void 0:t._id)===r?(0,a.jsx)(i(),{href:"/edit/moment/".concat(s),prefetch:!1,className:"h-full rounded-full p-1 border-[1px] border-white/20 hover:border-white/50 transition-colors duration-200 px-3 flex items-center cursor-pointer",rel:"nofollow",children:(0,a.jsx)(l,{className:"size-4"})}):null}},4497:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var a=s(53400),l=s(87555),n=s(92380),r=s(77440),i=s(53395);function o(e){let{open:t,onOpenChange:s,title:o="",description:c="",showHeader:d=!0,onClose:u,headerExtra:m,trigger:h,children:x,headerClassName:g,contentClassName:f,layoutClassName:p}=e;return(0,a.jsxs)(l.lG,{open:t,onOpenChange:s,children:[h&&(0,a.jsx)(r.zM,{asChild:!0,children:h}),(0,a.jsxs)(l.Cf,{showClose:!1,className:(0,n.cn)("w-[100vw] h-[100dvh] bg-h5-background md:max-w-xl md:h-[94dvh] md:rounded-2xl md:overflow-hidden block text-white",f),children:[(0,a.jsxs)(l.c7,{className:"hidden",children:[(0,a.jsx)(l.L3,{children:o}),(0,a.jsx)(l.rr,{children:c})]}),d?(0,a.jsx)(i.A,{title:o,onClose:u,headerExtra:m,headerClassName:g,contentClassName:p,children:x}):x]})]})}},7494:(e,t,s)=>{"use strict";s.d(t,{ChatLayoutGradient:()=>m});var a=s(53400),l=s(92380);let n=(e,t,s)=>{let a=Math.max(e/=255,t/=255,s/=255),l=Math.min(e,t,s),n=0,r=0,i=(a+l)/2;if(a!==l){let o=a-l;switch(r=i>.5?o/(2-a-l):o/(a+l),a){case e:n=(t-s)/o+6*(t<s);break;case t:n=(s-e)/o+2;break;case s:n=(e-t)/o+4}n/=6}return[n,r,i]},r=(e,t,s)=>{let a,l,n;if(0===t)a=l=n=s;else{let r=(e,t,s)=>(s<0&&(s+=1),s>1&&(s-=1),s<1/6)?e+(t-e)*6*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e,i=s<.5?s*(1+t):s+t-s*t,o=2*s-i;a=r(o,i,e+1/3),l=r(o,i,e),n=r(o,i,e-1/3)}return[Math.round(255*a),Math.round(255*l),Math.round(255*n)]},i=e=>e*(.6+.09999999999999998*(1-e)),o=async(e,t)=>new Promise((s,a)=>{let l=new window.Image;l.src=e,l.onload=()=>{let e=document.createElement("canvas"),o=e.getContext("2d");if(o){e.width=l.width,e.height=l.height,o.drawImage(l,0,0);let a=o.getImageData(0,.8*l.height,l.width,.2*l.height).data,c=0,d=0,u=0,m=a.length/4;for(let e=0;e<a.length;e+=4)c+=a[e],d+=a[e+1],u+=a[e+2];let[h,x,g]=n(c=Math.round(c/m),d=Math.round(d/m),u=Math.round(u/m)),[f,p,b]=r(h,x,i(g));null==t||t("rgb(".concat(f,", ").concat(p,", ").concat(b,")")),s("rgb(".concat(f,", ").concat(p,", ").concat(b,")"))}else null==t||t(null),a(Error("Failed to get canvas context"))},l.onerror=e=>{console.error("Error loading image:",e),null==t||t(null),a(e)}});var c=s(28235),d=s(30426),u=s(48276);let m=e=>{let{bgUrl:t}=e,[s]=(0,c.lh)(),[n,r]=(0,u.useState)("#000000"),[i,m]=(0,u.useState)(!1);return((0,u.useEffect)(()=>{t&&o("/_next/image?url=".concat(encodeURIComponent(t),"&w=640&q=75&anim=false"),e=>{e&&r(e)})},[t]),(0,u.useEffect)(()=>{m(!0)},[]),i)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.n,{side:"bottom",className:(0,l.cn)("absolute bottom-0 w-full lg:hidden",s?"h-[80dvh]":"h-[60dvh]"),strength:20,falloffPercentage:100,tint:"rgba(28,29,30,0.01)"}),(0,a.jsx)("div",{className:(0,l.cn)("fixed inset-x-0 bottom-0 w-full lg:hidden pointer-events-none",s?"h-[80dvh]":"h-[60dvh]"),children:(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-transparent",style:{backgroundImage:"linear-gradient(to bottom, \n                rgba(".concat(n.slice(4,-1),", 0.00) 0%, \n                rgba(").concat(n.slice(4,-1),", 0.60) 9.91%, \n                ").concat(n," 100%\n              )")}})})]}):null}},7586:(e,t,s)=>{"use strict";s.d(t,{C:()=>c,z:()=>o});var a=s(53400),l=s(79481),n=s(68087),r=s(48276),i=s(92380);let o=r.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.bL,{className:(0,i.cn)("grid gap-2",s),...n,ref:t})});o.displayName=l.bL.displayName;let c=r.forwardRef((e,t)=>{let{className:s,children:r,...o}=e;return(0,a.jsx)(l.q7,{ref:t,className:(0,i.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...o,children:r||(0,a.jsx)(l.C1,{className:"flex items-center justify-center",children:(0,a.jsx)(n.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});c.displayName=l.q7.displayName},7626:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var a=s(53400),l=s(92380),n=s(63138),r=s(90169);function i(e){let{title:t,className:s,showClose:i=!0,closeChildren:o,onClose:c,extra:d,fitMenu:u=!1,defaultCloseBack:m=!0,...h}=e;return(0,a.jsxs)("header",{className:(0,l.cn)("flex items-center justify-between",s),...h,children:[(0,a.jsx)("div",{className:"flex items-center min-w-[70px]",children:i&&(o||(0,a.jsx)(r.HeaderClose,{fitMenu:u,defaultCloseBack:m,onClose:c}))}),(0,n.K)(t)?(0,a.jsx)("h2",{className:"text-base",children:t}):t,(0,a.jsx)("div",{className:"flex items-center justify-end gap-2 min-w-[70px]",children:d})]})}},15035:(e,t,s)=>{"use strict";s.d(t,{StateController:()=>h});var a=s(71022),l=s(37070),n=s(41203),r=s(19107),i=s(19590),o=s(10190),c=s(90885),d=s(67569),u=s(48276),m=s(57076);function h(e){let{momentId:t,momentData:s,characterData:h}=e,{startWaiting:x,endWaiting:g}=(0,n.gw)(),[f,p]=(0,d.ab)(m.V),b=(0,c.useQuery)({queryKey:["modelList"],queryFn:()=>(0,i.o3)(),staleTime:864e5,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1}),v=(0,c.useQuery)({queryKey:["chat-session"],queryFn:()=>(0,i.PT)({sessionId:f.sessionId}),staleTime:864e5,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,enabled:!1}),j=(0,c.useQuery)({queryKey:["chat-lastSession"],queryFn:()=>(0,i._2)({momentId:t}),staleTime:864e5,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,enabled:!1}),w=(0,c.useQuery)({queryKey:["momentPersona",t],queryFn:()=>(0,i.FC)(t),refetchOnWindowFocus:!1,refetchOnMount:!1,enabled:!!t});return(0,a.B)(w,{onSuccess:e=>{o.A.setState({personaName:e.name})}}),(0,a.B)(b,{onSuccess:e=>{let t=o.A.getState();if(Array.isArray(e)&&e.length>0&&"series_name"in e[0]){let s=t.chooseModel,a=s;s&&(0,r.yi)(e,s)||(a=(0,r.Rq)(e)),o.A.setState({modelList:e,...a&&a!==s?{chooseModel:a}:{}}),a&&a!==s&&t.setChooseModel(a)}else o.A.setState({modelList:e})}}),(0,l.i)(()=>{o.A.setState({isSending:!1,isReceiving:!1,sessionId:"",momentData:void 0,characterData:void 0,personaName:void 0})}),(0,u.useEffect)(()=>{o.A.setState({sessionId:f.sessionId})},[f.sessionId]),(0,u.useEffect)(()=>{o.A.setState({momentData:s,characterData:h}),(async()=>{try{if(x("chat-session:init"),f.sessionId){let e=await v.refetch();e.data&&o.A.setState({chatData:e.data})}else{let e=await j.refetch();e.data&&e.data.length>0&&(o.A.setState({chatData:e.data,sessionId:e.data[0].session_id}),p({sessionId:e.data[0].session_id}))}}catch(e){console.error("Error fetching data:",e)}finally{g("chat-session:init")}})()},[t]),null}},15635:(e,t,s)=>{"use strict";s.d(t,{default:()=>p});var a=s(53400);let l={src:"/_next/static/media/collapse-side.ff60e097.svg",height:24,width:24,blurWidth:0,blurHeight:0},n={src:"/_next/static/media/retract.0599576f.svg",height:11,width:12,blurWidth:0,blurHeight:0};var r=s(43619),i=s(71141),o=s(90452),c=s(92380),d=s(28235),u=s(55766),m=s(10190),h=s(1233),x=s(36405),g=s(48276);let f=g.memo(e=>{let{name:t,characterId:s}=e,f=(0,m.A)(e=>e.showRight),p=(0,m.A)(e=>e.setShowRight),b=(0,h.Xr)(u.w),[v]=(0,d.lh)();(0,g.useEffect)(()=>{let e=window.matchMedia("(min-width: 1440px)"),t=e=>{p(e.matches)};return p(e.matches),e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[p]);let j=g.useMemo(()=>(0,a.jsxs)("div",{className:(0,c.cn)("absolute lg:left-[141px] left-10 p-1 max-lg:h-8 top-2 md:top-5 flex items-center gap-1.5 rounded-full bg-[#2B2D3380]",f?"md:hidden":""),children:[(0,a.jsx)("div",{className:"size-7 lg:size-8",children:(0,a.jsx)(r.default,{id:s,alt:"Avatar",className:"rounded-full w-full h-full"})}),(0,a.jsx)("span",{className:"text-center leading-none text-sm",children:t}),(0,a.jsx)(i.default,{characterId:s,defaultFollow:!1}),(0,a.jsx)("div",{className:"absolute left-0 top-[calc(100%+4px)] md:hidden",children:v?null:(0,a.jsx)(o.H,{className:"bg-[#2B2D3380] rounded-full break-keep text-[10px] px-2 h-6"})})]}),[s,t,f,v]);return(0,a.jsxs)("div",{className:"w-full fixed top-0 flex h-20 justify-between px-8 pt-5 z-20 max-lg:pt-1",children:[(0,a.jsx)("div",{className:"md:hidden fixed left-0 top-0 w-full h-12 z-1",style:{background:"linear-gradient(to bottom, #16122399 0%, #16122333 60%, #16122300 100%)"}}),(0,a.jsx)("button",{type:"button",onClick:()=>b(!0),className:"flex h-10 w-10 items-center justify-center rounded-lg bg-[rgba(102,112,128,0.60)] backdrop-blur-[15px] transition-colors duration-200 cursor-pointer max-lg:hidden",children:(0,a.jsx)(x.default,{src:l,alt:"collapse icon"})}),j,(0,a.jsx)("div",{className:"flex space-x-4",children:(0,a.jsx)("button",{type:"button",onClick:()=>{window.innerWidth<768?window.location.href="/character/".concat(s):p(!f)},className:"max-lg:hidden flex h-10 w-10 items-center justify-center rounded-full backdrop-blur-[10px] bg-[rgba(102,112,128,0.60)] transition-colors duration-200 cursor-pointer",children:(0,a.jsx)(x.default,{src:n,alt:"retract",width:14,height:14})})})]})});f.displayName="TopInformation";let p=f},16310:(e,t,s)=>{"use strict";s.d(t,{t:()=>l});var a=s(10190);async function l(){a.A.setState(e=>{var t;let s=[...e.chatData];if(!s.length)return{chatData:[]};for(;(null==(t=s.at(-1))?void 0:t.role)!=="user";)s.pop();let l=s[s.length-1];return a.A.setState({askValue:l.text}),{chatData:s.slice(0,-1)}})}},19107:(e,t,s)=>{"use strict";s.d(t,{Rq:()=>r,qt:()=>l,yi:()=>n});var a=s(48276);function l(e,t,s){(0,a.useEffect)(()=>{if(0===e.length)return;let a=()=>{var t,s,a;return null==(a=e[0])||null==(s=a.models)||null==(t=s[0])?void 0:t.model};if(t){if(!e.some(e=>{var s;return null==(s=e.models)?void 0:s.some(e=>e.model===t)})){let e=a();e&&s(e)}}else{let e=a();e&&s(e)}},[e,t,s])}function n(e,t){return!!t&&e.some(e=>{var s;return null==(s=e.models)?void 0:s.some(e=>e.model===t)})}function r(e){var t,s,a;return null==(a=e[0])||null==(s=a.models)||null==(t=s[0])?void 0:t.model}},27951:(e,t,s)=>{"use strict";s.d(t,{Tabs:()=>i,TabsContent:()=>d,TabsList:()=>o,TabsTrigger:()=>c});var a=s(53400),l=s(95278),n=s(48276),r=s(92380);let i=l.bL,o=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.B8,{ref:t,className:(0,r.cn)("inline-flex items-center",s),...n})});o.displayName=l.B8.displayName;let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.l9,{ref:t,className:(0,r.cn)("inline-flex items-center justify-center whitespace-nowrap px-3 py-1.5 text-sm font-medium transition-all focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50 text-[#8E8E8F] data-[state=active]:text-white",s),...n})});c.displayName=l.l9.displayName;let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.UC,{ref:t,className:(0,r.cn)("ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 scrollbar-hide",s),...n})});d.displayName=l.UC.displayName},28235:(e,t,s)=>{"use strict";s.d(t,{LG:()=>u,PC:()=>f,f1:()=>m,lh:()=>h,qb:()=>c,yA:()=>d});var a=s(41401),l=s(1233),n=s(72197),r=s(63171),i=s(31074),o=s(48276);let c=(0,r.tG)("chatUseAnim",!1),d=(0,r.tG)("chatAutoScroll",!0),u=(0,r.tG)("chatFullScreen",!1),m=(0,r.tG)("chatAutoPlayBgm",!0),h=()=>{let e=(0,i.useCookies)(),[t,s]=(0,l.fp)(u);return[t,t=>{s(t),e.set(a.zs.CHAT_FULL_SCREEN,String(t),{path:"/",expires:720})}]},x=(0,n.eU)(!1),g=(0,n.eU)(new Map),f=()=>{let[e,t]=(0,l.fp)(x),[s,a]=(0,l.fp)(g),n=(0,o.useCallback)(e=>{a(t=>{let s=new Map(t);return s.set(e.id,e),s})},[a]),r=(0,o.useCallback)(e=>{a(t=>{let s=new Map(t);return s.delete(e),s})},[a]),i=(0,o.useCallback)((e,t)=>{a(s=>{let a=new Map(s);return a.has(e)?a.delete(e):a.set(e,t),a})},[a]),c=(0,o.useCallback)(()=>{a(new Map)},[a]),d=(0,o.useCallback)(()=>{t(!0)},[t]),u=(0,o.useCallback)(()=>{t(!1),c()},[t,c]);return{isSelectMode:e,setIsSelectMode:t,selected:s,toggleSelected:i,addSelected:n,removeSelected:r,clearSelected:c,openSelectMode:d,closeSelectMode:u}}},29391:(e,t,s)=>{"use strict";s.d(t,{d:()=>i});var a=s(53400),l=s(48276),n=s(27058),r=s(92380);let i=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(n.bL,{className:(0,r.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...l,ref:t,children:(0,a.jsx)(n.zi,{className:(0,r.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});i.displayName=n.bL.displayName},30723:(e,t,s)=>{"use strict";s.d(t,{ChatBottom:()=>ex});var a=s(53400),l=s(28235),n=s(92380),r=s(75245),i=s(10190);async function o(e,t){let s=i.A.getState().sessionId,a={moment_id:e._id,session_id:s,option:"suggestions"};i.A.getState().setIsSending(!0);try{var l;let e=null==(l=(await (0,r.Ay)("/completion/input/tips",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).body)?void 0:l.getReader(),s=new TextDecoder,n="",i=[],o=0;for(;;){let{done:a,value:l}=await e.read();if(a)break;let r=s.decode(l,{stream:!0});if((n+=r).includes("%%%SPLIT%%%")){let e=n.split("%%%SPLIT%%%");for(;e.length>1;){let s=e.shift().trim();if(s.length>0){let e=s.replace(/<\/?[^>]+(>|$)/g,"");i.push(e),t&&o<3&&(t(e,o),o++)}}n=e[0]}}return i.slice(0,3)}catch(e){return console.error("Error generating suggestions:",e),null}finally{i.A.getState().setIsSending(!1)}}var c=s(48276);let d={src:"/_next/static/media/ai.b8d09e96.svg",height:20,width:20,blurWidth:0,blurHeight:0},u={src:"/_next/static/media/collapse-bottom.1cb53fb8.svg",height:24,width:24,blurWidth:0,blurHeight:0};var m=s(54650);let h={src:"/_next/static/media/stopChat.06c0704f.svg",height:32,width:32,blurWidth:0,blurHeight:0},x={src:"/_next/static/media/withdraw-bottom.6349e7ac.svg",height:24,width:24,blurWidth:0,blurHeight:0};var g=s(23785),f=s(84467),p=s(79896),b=s(16310),v=s(81909);async function j(e){let{message:t,momentId:s,pathname:a,replace:l,textareaRef:n}=e;if(i.A.getState().isSending)return void await function(){let e=i.A.getState().abortController;e&&(e.abort(),i.A.setState({abortController:null}))}();if(!t)return;i.A.getState().setIsSending(!0);let r=new AbortController;i.A.setState({abortController:r});let o=i.A.getState().sessionId,c={message_id:Date.now().toString(),text:t,round_id:"",session_id:o||"",created_at:new Date().toISOString(),role:"user"};i.A.setState(e=>({chatData:[...e.chatData,c]}));try{var d;i.A.setState({askValue:""}),(null==n?void 0:n.current)&&(n.current.style.height="auto"),(0,f.b)("chat",{model:i.A.getState().chooseModel});let e=await w(t,s,r.signal);if(!e.ok)return;let c=e.headers.get("x-session-id");i.A.setState({runId:e.headers.get("x-run-id")||""}),i.A.getState().setIsReceiving(!0),c&&(l("".concat(a,"?sessionId=").concat(c)),i.A.setState({sessionId:c}));let u=e.headers.get("x-q-message-id"),m=e.headers.get("x-round-id")||"";i.A.setState(e=>{let t=[...e.chatData],s=(0,p.Kl)(t,e=>"user"===e.role);return -1!==s&&(t[s]={...t[s],message_id:u||t[s].message_id,round_id:m}),{chatData:t}});let h={message_id:e.headers.get("x-r-message-id")||"",text:"",round_id:m,session_id:c||o||"",created_at:new Date().toISOString(),role:"ai"};i.A.setState(e=>({chatData:[...e.chatData,h]}));let x=null==(d=e.body)?void 0:d.getReader(),g=new TextDecoder;for(;x;){let{done:e,value:t}=await x.read();if(e)break;let s=g.decode(t,{stream:!0});(0,v.l)(s)}}catch(e){"AbortError"===e.name||((0,b.t)(),g.oR.error("Request failed: ".concat(e)))}finally{i.A.getState().setIsSending(!1),i.A.getState().setIsReceiving(!1),i.A.setState({abortController:null})}}async function w(e,t,s){var a,l,n;let o=i.A.getState().sessionId,c={query:e,model:i.A.getState().chooseModel||(null==(l=i.A.getState().modelList)||null==(a=l[0])?void 0:a.model)||"",moment_id:t,length:null!=(n=i.A.getState().historyLength)?n:"medium",session_id:o||void 0,...i.A.getState().isAdvancedMode?{top_n:i.A.getState().topNValue}:{}};return(0,r.Y0)("/completion/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c),signal:s})}var y=s(16190),N=s(36405),k=s(83398);let C=e=>{let{momentData:t,onAiClick:s,isMenuOpen:l=!1,onMenuToggle:r}=e,o=(0,c.useRef)(null);(0,c.useEffect)(()=>{i.A.setState({textareaRef:o})},[]);let g=(0,y.useTranslations)("chat")("placeHold"),f=(0,k.usePathname)(),p=(0,k.useRouter)().replace,b=e=>{if(i.A.setState({askValue:e}),null==o?void 0:o.current){o.current.style.height="auto";let e=o.current.scrollHeight;o.current.style.height="".concat(e,"px")}};(0,c.useEffect)(()=>{if(!o.current)return;let e=o.current,t=()=>{e.style.height="auto",e.style.height="".concat(e.scrollHeight,"px")},s=new MutationObserver(e=>{for(let s of e)("characterData"===s.type||"childList"===s.type)&&t()});return s.observe(e,{characterData:!0,childList:!0,subtree:!0}),()=>s.disconnect()},[]);let v=(0,i.A)(e=>e.isSending),w=(0,i.A)(e=>e.isReceiving),C=(0,i.A)(e=>e.askValue),A=C.trim().length>0;return(0,a.jsxs)("div",{className:"relative flex items-center rounded-xl overflow-hidden w-full",children:[(0,a.jsx)("div",{className:"absolute inset-0 rounded-xl hidden lg:block z-10",style:{padding:"1.5px",background:"linear-gradient(90deg, #00EBFF 0%, #8972FE 84%, #AE8DFF 100%)",WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",maskComposite:"exclude",pointerEvents:"none"}}),(0,a.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-12 flex items-center justify-center z-20",children:(0,a.jsx)(N.default,{width:20,height:20,onClick:s,className:"size-5 cursor-pointer ease-in-out hover:scale-110 transition-transform duration-200",src:d,alt:"",style:{opacity:v?.3:1,pointerEvents:v?"none":"auto"}})}),(0,a.jsx)("div",{className:"w-full h-full flex items-center py-2 px-4 lg:bg-[rgba(35,51,68,0.6)] rounded-xl lg:min-h-[48px] min-h-[40px] backdrop-blur-[20px] bg-white/10 resize-none leading-[20px] border border-white/20",children:(0,a.jsx)("textarea",{ref:o,placeholder:g,className:"w-full bg-transparent custom-scrollbar text-white placeholder-white/50 outline-none resize-none leading-[20px] scrollbar-hide ml-6 mr-6",value:C,onChange:e=>b(e.target.value),onKeyDown:e=>{"Enter"===e.key&&e.shiftKey&&(e.preventDefault(),j({message:C,momentId:t._id,pathname:f,replace:p,textareaRef:o}))},rows:1,style:{height:"auto",maxHeight:"100px",overflowY:"auto"}})}),(0,a.jsxs)("div",{className:"absolute right-0 top-0 bottom-0 w-12 flex items-center justify-center z-20",children:[!w&&!A&&r&&(0,a.jsx)(N.default,{width:24,height:24,src:l?x:u,alt:"Menu",className:(0,n.cn)("cursor-pointer w-6 h-6 transition-transform duration-300",l?"rotate-180":""),onClick:r}),(A||w)&&(0,a.jsx)(N.default,{width:32,height:32,className:"size-8 cursor-pointer ease-in-out hover:scale-110 transition-transform duration-200",src:w?h:m.A,alt:"Send message",onClick:async()=>j({message:C,momentId:t._id,pathname:f,replace:p,textareaRef:o}),style:{opacity:w?1:v?.3:1,pointerEvents:w?"auto":v?"none":"auto"}})]})]})};var A=s(57076),_=s(50122),S=s(89657),I=s(90452),M=s(41401);async function L(e,t){t("/chat/".concat(e)),i.A.setState({chatData:[]}),i.A.setState({sessionId:""})}var P=s(67569);s(69011),s(98993);let R=async e=>{let t=await (0,r.Ay)("/session/export/".concat(e),{method:"GET"}),s=new Blob([await t.text()],{type:"text/plain;charset=utf-8"});(0,p.PE)(s,{filename:"chat-export-".concat(e,".txt")})},D=e=>{let{icon:t,label:s,className:l,...r}=e;return(0,a.jsxs)("button",{type:"button",className:(0,n.cn)("flex flex-col items-center justify-center group",l),...r,children:[(0,a.jsx)("div",{className:"text-[28px] mb-[6px] text-white",children:t}),(0,a.jsx)("span",{className:"text-[10px] leading-[14px] text-white/80 group-hover:text-white",children:s})]})};var F=s(97829),T=s(19178),E=s(41887),z=s(32361),B=s(18869);let O=e=>{let{className:t,bgUrl:s,messages:l,loading:r=!1,onShareMemory:i,...o}=e,d=(0,y.useTranslations)(),[u,m]=(0,c.useState)("");return(0,a.jsxs)("div",{className:(0,n.cn)("p-3 md:p-6",t),...o,children:[(0,a.jsx)(z.p,{value:u,onChange:e=>m(e.target.value),className:"bg-h5-input border-none rounded-lg text-sm mb-8",placeholder:d("chat.share.titlePlaceholder")}),(0,a.jsxs)("section",{className:"flex justify-center w-full relative rounded-xl h-[calc(100dvh-400px)] overflow-hidden",children:[(0,a.jsxs)("div",{className:"absolute inset-0 z-0 w-full h-full",children:[s&&(0,a.jsx)("img",{src:s,alt:"memory",className:"rounded-xl object-cover object-top w-full"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black opacity-50 z-[1] rounded-xl"})]}),(0,a.jsx)("div",{className:"relative z-10 w-full h-full px-3 rounded-xl text-white overflow-y-auto main-container",children:l.map((e,t)=>{let s="".concat(e.id,"-").concat(t);return(0,a.jsx)(B.default,{canControl:!1,canEdit:!1,text:e.content,message_id:e.id,isLeft:"ai"===e.role},s)})})]}),(0,a.jsx)("div",{className:"flex items-center justify-center mt-10",children:(0,a.jsx)(E.$,{className:"bg-h5-block-gradient rounded-lg font-normal w-1/2 flex items-center justify-center",onClick:()=>i(u),disabled:r,children:r?(0,a.jsx)(T.X,{}):d("global.confirm")})})]})};var V=s(19590),H=s(3666);let q=e=>{let{isMobile:t,bgUrl:s}=e,l=(0,y.useTranslations)(),[n]=(0,P.ab)(A.V),[r,o]=(0,c.useState)(!1),d=(0,i.A)(e=>e.chatData),u=(0,c.useMemo)(()=>r?d.slice(-5).map((e,t)=>({role:e.role,content:e.text,idx:t,id:e.message_id,createdAt:e.created_at})):[],[r,d]),m=(0,H.useMutation)({mutationFn:V.HX,onSuccess:()=>{o(!1)},onError:e=>{console.error(e)}}),h=(0,c.useCallback)(async e=>{if(e.trim().length<3||e.trim().length>30)return void g.oR.error(l("chat.share.valid.title",{min:3,max:30}));m.mutateAsync({title:e,sessionId:n.sessionId})},[m,n.sessionId,l]);return(0,a.jsx)(F.I,{isMobile:t,open:r,setOpen:o,title:l("chat.chatArchive"),trigger:(0,a.jsx)(D,{icon:(0,a.jsx)(_.A.IconChatArchive,{}),label:l("chat.chatArchive"),onClick:()=>o(!0)}),className:"h-auto md:h-auto",headerClassName:"pt-2 md:px-6 md:pt-6",children:(0,a.jsx)(O,{loading:m.isPending,bgUrl:s,messages:u,onShareMemory:e=>h(e)})})};var W=s(75318),U=s(28379),K=s(43972),Z=s(90885),$=s(25878),G=s(75568),J=s(38759);let X=e=>{let{isManage:t,isSelected:s=!1,isMobile:l,momentId:r,sessionId:i,queryText:o,responseText:c,lastResponseAt:d,onDelete:u,onSelect:m,className:h,...x}=e,g=(0,y.useTranslations)(),f=(0,y.useFormatter)(),p=[{label:g("global.delete"),onClick:()=>{null==u||u(i)}}];return(0,a.jsxs)("div",{className:(0,n.cn)("flex items-center gap-2 relative",t&&"cursor-pointer pl-9 hover:bg-white/10 rounded-xl py-2 pr-2",s&&"bg-white/10",h),...x,onClick:e=>{t&&(e.stopPropagation(),null==m||m())},children:[t&&(0,a.jsx)(J.i,{isSelect:s}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("header",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("div",{className:"text-sm text-white",children:f.dateTime(new Date(d),{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,a.jsx)("div",{children:(0,a.jsx)(G.u,{isMobile:l,className:"gap-1.5 py-0.5 px-2 rounded-lg hover:bg-white/20",navItems:p,align:"end"})})]}),(0,a.jsxs)("div",{className:(0,n.cn)("bg-card-background rounded-xl p-3 space-y-3 overflow-y-auto scrollbar-hide max-h-52 md:max-h-72 border border-transparent",!t&&"hover:border-border/20 cursor-pointer"),onClick:e=>{t||(e.preventDefault(),e.stopPropagation(),window.location.href="/chat/".concat(r,"?sessionId=").concat(i))},children:[(0,a.jsx)(B.default,{canEdit:!1,canControl:!1,isLeft:!1,text:o}),(0,a.jsx)(B.default,{canEdit:!1,canControl:!1,isLeft:!0,text:c,isLastMessage:!1})]})]})]})},Q=e=>{let{isLoading:t,data:s,isMobile:l,isManage:r,selected:i,onDelete:o,onSelect:c,onUnselect:d,className:u,...m}=e;return(0,a.jsx)("div",{className:(0,n.cn)("w-full p-4 text-white relative flex flex-col gap-5",u),...m,children:t?(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center min-h-72",children:(0,a.jsx)(T.X,{})}):(null==s?void 0:s.length)===0?(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center min-h-72",children:(0,a.jsx)($.A,{})}):null==s?void 0:s.map(e=>(0,a.jsx)(X,{isManage:r,isSelected:i.includes(e.session_id),isMobile:l,momentId:e.moment_id,sessionId:e.session_id,queryText:e.last_query,responseText:e.last_response,lastResponseAt:e.last_response_at,onDelete:o,onSelect:()=>{r&&(i.includes(e.session_id)?null==d||d(e.session_id):null==c||c(e.session_id))}},e.session_id))})},Y=e=>{let{isMobile:t,momentId:s}=e,l=(0,y.useTranslations)(),[r,i]=(0,c.useState)(!1),[o,d]=(0,c.useState)({mode:null,selected:[]}),u=(0,c.useCallback)(()=>{d({mode:"manage",selected:[]})},[]),m=(0,c.useCallback)(()=>{d({mode:null,selected:[]})},[]),h=(0,Z.useQuery)({queryKey:["chat-history-session",s],queryFn:()=>(0,V.d4)({momentId:s}),enabled:r}),x=(0,H.useMutation)({mutationFn:V.IT,onSuccess:(e,t)=>{let{sessionIds:s}=t;h.refetch(),d(e=>({...e,selected:e.selected.filter(e=>!s.includes(e))}))}}),g=(0,c.useCallback)(e=>{x.mutate({sessionIds:e})},[x]),f=(0,c.useMemo)(()=>{let e="manage"===o.mode;return t?(0,a.jsxs)("button",{type:"button",className:(0,n.cn)("bg-[#2B2D33] rounded-full py-2 px-4 text-sm text-white flex items-center gap-1.5",e&&"text-h5-primary"),onClick:()=>{e?m():u()},children:[(0,a.jsx)(W.B,{className:"text-base"}),(0,a.jsx)("span",{children:e?l("mine.assets.exitManage"):l("mine.assets.manage")})]}):(0,a.jsxs)("div",{className:(0,n.cn)("flex items-center gap-2"),children:[e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-sm",children:l("mine.assets.selected",{count:o.selected.length})}),(0,a.jsx)(ee,{selected:o.selected,onDelete:g,isDeleting:x.isPending}),(0,a.jsx)(K.Separator,{orientation:"vertical",className:"bg-white/10 h-5"})]}),(0,a.jsxs)("button",{type:"button",className:(0,n.cn)("bg-[#2B2D33] rounded-full py-2 px-4 text-sm text-white flex items-center gap-1.5","manage"===o.mode&&"text-h5-primary"),onClick:()=>{"manage"===o.mode?m():u()},children:[(0,a.jsx)(W.B,{className:"text-base"}),(0,a.jsx)("span",{children:"manage"===o.mode?l("mine.assets.exitManage"):l("mine.assets.manage")})]})]})},[o.mode,o.selected,l,t,g,x.isPending,u,m]);return(0,a.jsxs)(F.I,{isMobile:t,open:r,setOpen:i,title:l("chat.historyChat"),trigger:(0,a.jsx)(D,{icon:(0,a.jsx)(_.A.IconChatHistory,{}),label:l("chat.historyChat"),onClick:()=>i(!0)}),className:"h-[100dvh] md:h-auto",headerClassName:"md:px-4 md:pt-2",hasHandle:!1,headerExtra:f,children:[(0,a.jsx)(Q,{className:"max-h-[calc(100dvh-70px)] md:max-h-[calc(100dvh-120px)] overflow-y-auto scrollbar-hide",selected:o.selected,isManage:"manage"===o.mode,isLoading:h.isLoading,isMobile:t,data:h.data||[],onDelete:e=>g([e]),onSelect:e=>d(t=>({...t,selected:[...t.selected,e]})),onUnselect:e=>d(t=>({...t,selected:t.selected.filter(t=>t!==e)}))}),t&&"manage"===o.mode&&(0,a.jsx)("div",{className:"fixed md:absolute bottom-5 left-1/2 -translate-x-1/2 inline-flex items-center justify-center gap-3 w-full md:w-auto",children:(0,a.jsx)(ee,{selected:o.selected,onDelete:g,isDeleting:x.isPending})})]})};function ee(e){let{selected:t,onDelete:s,className:l,isDeleting:r,...i}=e,o=(0,y.useTranslations)();return(0,a.jsxs)("button",{type:"button",className:(0,n.cn)("bg-[#2B2D33] rounded-full py-2 px-4 text-sm text-white flex items-center gap-1.5 disabled:opacity-50 disabled:cursor-not-allowed",l),disabled:0===t.length,onClick:()=>{s(t)},...i,children:[r?(0,a.jsx)(T.X,{className:"text-base"}):(0,a.jsx)(U.E,{className:"text-base"}),(0,a.jsx)("span",{children:o("global.delete")})]})}let et=c.memo(e=>{let{momentId:t,momentImageVersion:s,isMenuOpen:l,historyRef:r,onCloseMenu:o,isMobile:c,className:d,...u}=e,[m]=(0,P.ab)(A.V),h=(0,y.useTranslations)("chat"),x=(0,k.useRouter)().replace,g=(0,M.jm)("".concat(t,"_large"),"moment",s),f=(0,i.A)(e=>e.showRight),p=(0,i.A)(e=>e.setShowRight),[b,v]=(0,P.ab)(S.H);return(0,a.jsx)("div",{className:(0,n.cn)("absolute bottom-0 left-0 right-0 transition-all duration-500 ease-in-out overflow-hidden rounded-t-xl",l?"h-36 opacity-100 animate-menu-appear":"h-0 opacity-0",d),style:{transitionTimingFunction:"cubic-bezier(0.34, 1.56, 0.64, 1)"},...u,children:(0,a.jsxs)("div",{className:(0,n.cn)("grid grid-cols-4 gap-4 p-4 h-full opacity-0 transform translate-y-4 transition-all duration-300",l?"opacity-100 translate-y-0":""),children:[(0,a.jsx)(D,{icon:(0,a.jsx)(_.A.IconChatAdd,{}),label:h("newChat"),onClick:()=>L(t,x)}),(0,a.jsx)(Y,{isMobile:c,momentId:t}),(0,a.jsx)(I.P,{icon:(0,a.jsx)(_.A.IconChatLen,{}),label:h("memoryLength")}),(0,a.jsx)(I.P,{icon:(0,a.jsx)(_.A.IconHostGroupFill,{}),label:h("chooseModel")}),(0,a.jsx)(q,{isMobile:c,bgUrl:g}),(0,a.jsx)(D,{icon:(0,a.jsx)(_.A.IconChatExport,{}),label:h("export"),onClick:()=>{R(m.sessionId)}}),(0,a.jsx)(D,{icon:(0,a.jsx)(_.A.IconChatSetting,{}),label:h("persona"),onClick:()=>{f||p(!0),v({tab:"setting"})}})]})})});et.displayName="InputMenu";let es=c.memo(e=>{let{suggestions:t,onSelectSuggestion:s,isOpen:l,momentData:r,historyRef:o,isLoading:d}=e,[u,m]=(0,c.useState)([]),h=(0,k.usePathname)(),x=(0,k.useRouter)().replace,g=(0,y.useTranslations)("chat");(0,c.useEffect)(()=>{for(let e of t)"done"!==e.status||u.some(t=>t.text===e.text)||m(t=>[e,...t])},[t,u.some]);let f=e=>{i.A.setState({askValue:e}),j({message:e,momentId:r._id,pathname:h,replace:x,textareaRef:i.A.getState().textareaRef})},p=t.filter(e=>"done"===e.status),b=p.length>0?p:[,,,].fill({text:g("loading"),status:"pending"}).reverse();return(0,a.jsx)("div",{className:(0,n.cn)("w-full absolute bottom-0 left-0 right-0 transition-all duration-300 ease-in-out overflow-hidden rounded-t-xl z-10 max-w-[434px] mx-auto mt-4 bg-transparent px-2",l?"max-h-56 h-auto":"h-0"),ref:o,children:(0,a.jsx)("div",{className:(0,n.cn)("p-1 flex flex-col text-neutral-500 gap-1 h-[8.5rem] justify-start overflow-y-auto","transition-all duration-1000 opacity-100 transform translate-y-0","scrollbar-thin scrollbar-gray-200 scrollbar-track-transparent"),style:{scrollbarWidth:"thin",scrollbarColor:"#505050 #737373"},children:b.map((e,t)=>(0,a.jsxs)("div",{className:(0,n.cn)("flex flex-row items-center p-1 rounded-lg bg-[rgba(255,255,255,0.08)] hover:bg-white/10 cursor-pointer text-white border border-white/10 group","pending"===e.status&&"opacity-50",d&&"pending"===e.status&&"animate-pulse"),children:[(0,a.jsx)("button",{type:"button",className:"flex-shrink-0 flex items-center gap-2 p-1.5 ml-2 rounded-md transition-colors hover:bg-white/15 cursor-pointer transform duration-600 ease-in-out",onClick:t=>{t.stopPropagation(),s(e.text)},title:"编辑此建议",children:(0,a.jsx)(_.A.IconEdit2,{className:"w-4 h-4"})}),(0,a.jsx)("div",{children:(0,a.jsx)(_.A.IconSeparator,{className:"w-4 h-4"})}),(0,a.jsx)("button",{type:"button",className:"text-left min-w-0 flex-1 px-1.5 mr-2 rounded-md hover:bg-white/10 transition-colors text-wrap text-sm leading-7 select-none",onClick:()=>f(e.text),title:"点击发送此消息",children:e.text})]},t))})})});es.displayName="SuggestionList";let ea=e=>{let{momentData:t,isMobile:s,onMenuStateChange:l}=e,[r,d]=(0,c.useState)(!1),[u,m]=(0,c.useState)(!1),[h,x]=(0,c.useState)([{text:"",status:"pending"},{text:"",status:"pending"},{text:"",status:"pending"}]),[g,f]=(0,c.useState)(!1),p=(0,c.useRef)(null);(0,c.useEffect)(()=>{l&&l(r||u)},[r,u,l]),(0,c.useEffect)(()=>{l&&l(r||u)},[r,u,l]);let b=async()=>{r&&d(!1);let e=!u;if(m(e),e)try{f(!0),x([]),await o(t,(e,t)=>{x(s=>{let a=[...s];for(;a.length<=t;)a.push({text:"",status:"pending"});return a[t]={text:e,status:"done"},a})})}catch(e){console.error("获取回复建议失败:",e),x([])}finally{f(!1)}};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:(0,n.cn)("w-full flex flex-col transition-transform duration-300 ease-in-out","max-w-[534px] mx-auto"),children:[(0,a.jsx)("div",{className:"flex w-full items-end z-10 mt-0 md:mt-4 max-md:px-3",children:(0,a.jsx)(C,{momentData:t,onAiClick:b,isMenuOpen:r,onMenuToggle:()=>{u&&m(!1),d(!r)}})}),(0,a.jsx)("div",{className:(0,n.cn)("w-full","relative","overflow-hidden","transition-all duration-300 ease-in-out",{"h-0":!r,"h-36":r}),children:(0,a.jsx)(et,{isMobile:s,momentId:t._id,momentImageVersion:t.image_version,isMenuOpen:r,historyRef:p,onCloseMenu:()=>{d(!1)}})}),(0,a.jsx)("div",{className:(0,n.cn)("w-full","relative","overflow-hidden","transition-all duration-300 ease-in-out",{"h-0":!u,"h-36":u}),children:(0,a.jsx)(es,{momentData:t,isOpen:u,historyRef:p,suggestions:h,onSelectSuggestion:e=>{i.A.setState({askValue:e}),m(!1)},isLoading:g})})]})})};var el=s(97413),en=s(7824),er=s(27333),ei=s(32306),eo=s(82636),ec=s(69328),ed=s(16720),eu=s(41203),em=s(21611);let eh=e=>{let{isMobile:t,className:s,bgUrl:r,momentName:i}=e,o=(0,y.useTranslations)(),{startWaiting:d,endWaiting:u,isWaiting:m}=(0,eu.gw)(),{closeSelectMode:h,selected:x}=(0,l.PC)(),{downloadByUrl:g}=(0,ed.m)(),[f,p]=(0,c.useReducer)((e,t)=>({...e,...t}),{mode:null}),b=(0,H.useMutation)({mutationFn:em.eO,onError:e=>{console.error(e)}}),v=(0,c.useCallback)(async e=>{d("share-".concat(e));try{let t=await b.mutateAsync({messageIds:Array.from(x.keys()),return_image:"image"===e});p({mode:e,link:null==t?void 0:t.short_url,image:null==t?void 0:t.image_url,cta:null==t?void 0:t.cta})}catch(e){console.error(e)}finally{u("share-".concat(e))}},[u,b,x,d]),j=(0,c.useCallback)(async e=>{d("share-memory");try{if(e.trim().length<3||e.trim().length>30)return void en.oR.error(o("chat.share.valid.title",{min:3,max:30}));let t=await b.mutateAsync({name:e,messageIds:Array.from(x.keys()),return_image:!1});p({mode:"link",image:null==t?void 0:t.image_url,link:null==t?void 0:t.short_url,cta:null==t?void 0:t.cta})}catch(e){console.error(e)}finally{u("share-memory")}},[u,b,x,d,o]),w=(0,c.useMemo)(()=>[{label:o("global.share"),disabled:!x.size,icon:(0,a.jsx)(ec.V,{}),loading:m("share-link"),onClick:()=>v("link")},{label:o("global.convertToImage"),icon:(0,a.jsx)(ei.d,{}),disabled:!x.size,loading:m("share-image"),onClick:()=>v("image")},{label:o("chat.share.shareToMemory"),icon:(0,a.jsx)(eo.x,{}),disabled:!x.size,loading:m("share-memory"),onClick:()=>{p({mode:"memory"})}},{label:o("chat.share.cancelShare"),onClick:()=>{h()}}],[v,h,x.size,m,o]),N=(0,c.useMemo)(()=>{if(!f.mode)return null;if(["image","link"].includes(f.mode))return(0,a.jsx)(er.G,{isMobile:t,loading:m("share-".concat(f.mode)),open:!0,onOpenChange:e=>{e||(p({mode:null}),h())},image:f.image,link:f.link,cta:f.cta,shareTitle:i,onDownload:async()=>{"image"===f.mode&&f.image&&await g("rubii-".concat(i,"-").concat(Date.now(),".webp"),f.image)},cardTools:{showImage:!0,showCopy:!0}});if("memory"===f.mode){let e=(0,el.U)(Array.from(x.values()),["idx"]);return(0,a.jsx)(F.I,{title:o("chat.share.shareToMemoryFull"),isMobile:t,open:"memory"===f.mode,setOpen:e=>p({mode:e?"memory":null}),className:"h-auto md:h-auto",headerClassName:"md:px-6 pt-4",children:(0,a.jsx)(O,{loading:m("share-memory"),bgUrl:r,messages:e,onShareMemory:e=>j(e)})})}return null},[r,j,t,m,f,x.values,h,g,i,o]);return(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("div",{className:(0,n.cn)("grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3 py-3",s),children:w.map(e=>(0,a.jsxs)(E.$,{className:"w-full bg-[#66708099] rounded-lg backdrop-blur-sm h-9 flex items-center justify-center gap-2 text-xs md:text-sm",onClick:e.onClick,disabled:e.disabled||e.loading,children:[e.loading?(0,a.jsx)(T.X,{}):e.icon,(0,a.jsx)("span",{children:e.label})]},e.label))}),N]})},ex=e=>{let{isMobile:t,momentData:s,bgUrl:n}=e,{isSelectMode:r}=(0,l.PC)();return r?(0,a.jsx)(eh,{className:"max-w-[534px] mx-auto w-full px-3",isMobile:t,bgUrl:n,momentName:s.name}):(0,a.jsx)(ea,{isMobile:t,momentData:s})}},36854:(e,t,s)=>{"use strict";s.d(t,{ChatModelPicker:()=>ee});var a=s(53400),l=s(87555),n=s(1233),r=s(16190),i=s(19107),o=s(92380),c=s(10190),d=s(48276),u=s(98169),m=s(50122),h=s(7586),x=s(97223),g=s(79481),f=s(87133),p=s(32015),b=s(36405);let v=e=>{let{className:t,plus:s,free:l,...n}=e,i=(0,r.useTranslations)("chat.model.rubii"),c=s?i("plus"):l?i("free"):"";return(0,a.jsxs)("div",{className:(0,o.cn)("flex items-center relative",t),...n,children:[(0,a.jsx)("img",{src:"/images/common/rubii-star.png",alt:"model-badge",className:"size-5 absolute top-1/2 -left-[11px] -translate-y-1/2"}),(0,a.jsx)("div",{className:"flex items-center h-4 pl-3",style:{background:"linear-gradient(90deg, #FFD600 0.06%, #0FF 99.96%)"},children:(0,a.jsx)("img",{src:"/images/common/rubii-plus.png",alt:"model-badge",className:"h-4"})}),(0,a.jsx)("div",{className:"h-4 pr-2 flex items-center justify-center rounded-tr-[13px]",style:{background:"#0FF"},children:(0,a.jsx)("span",{className:"uppercase text-[11px] leading-none font-bold text-[#1C1D1E] [text-shadow:0.5px_0.5px_0px_#FFF]",children:c})})]})},j=[{status:0,$text:"0",className:"border-green-500 bg-green-500/20 text-green-400"},{status:1,$text:"1",className:"border-orange-500 bg-orange-500/20 text-orange-400"},{status:2,$text:"2",className:"border-red-500 bg-red-500/20 text-red-400"}],w=e=>{let{status:t,className:s,...l}=e,n=(0,r.useTranslations)("chat.model.status"),i=j.find(e=>e.status===t);return(0,a.jsxs)("div",{className:(0,o.cn)("inline-flex items-center gap-1.5 h-5 px-2 rounded-full border",null==i?void 0:i.className,s),...l,children:[(0,a.jsx)("span",{className:"size-1 rounded-full bg-current"}),(0,a.jsx)("span",{className:"text-xs",children:n(null==i?void 0:i.$text)})]})},y=e=>{let{price:t,unit:s,className:l,...n}=e,i=(0,r.useTranslations)("chat");return(0,a.jsx)("div",{className:(0,o.cn)("inline-flex items-center gap-1 text-sm text-[#0DCAFF]",l),...n,children:0===t?i("more.free"):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:t}),(0,a.jsx)(b.default,{src:p.A.iconRuby,alt:"ruby",width:14,height:14}),(0,a.jsx)("span",{children:"/"}),(0,a.jsx)("span",{children:s})]})})},N={src:"/_next/static/media/icon-fire-big.a5d2c7ac.svg",height:20,width:20,blurWidth:0,blurHeight:0},k={src:"/_next/static/media/icon-fire-small.f3957182.svg",height:20,width:20,blurWidth:0,blurHeight:0},C=e=>{let{active:t,name:s,model:l,price:n,unit:r,popularity:i,description:c,uptime:m,isFree:x,isPlus:p,radarChildren:b,className:j,onClick:w,...y}=e,[N,k]=(0,d.useState)(!1);return(0,a.jsxs)(u.Ay,{"data-model":l,wrapperClassName:(0,o.cn)("rounded-[13px] hover:bg-h5-block-gradient",t?"bg-h5-block-gradient":"bg-[#363A42]"),className:(0,o.cn)("relative w-full rounded-xl bg-[#363A42] has-[[data-state=checked]]:border-ring p-3 px-2 cursor-pointer",(x||p)&&"pt-5",j),...y,onClick:e=>{let t=e.currentTarget.querySelector('[role="radio"]');t&&!t.contains(e.target)&&t.click()},children:[(x||p)&&(0,a.jsx)(v,{className:"absolute top-0 right-0",plus:p,free:x}),(0,a.jsx)(A,{name:s,model:l,price:n,unit:r,popularity:null!=i?i:0,description:null!=c?c:"",uptime:null!=m?m:0,radioChildren:e=>(0,a.jsx)(h.C,{value:e,id:e,className:"size-5 border-white/50 data-[state=checked]:border-h5-primary focus-visible:ring-0",children:(0,a.jsx)(g.C1,{className:"w-full h-full rounded-full flex items-center justify-center bg-h5-primary",children:(0,a.jsx)(f.i,{className:"text-[#1C1D1E] size-3"})})})}),b&&(0,a.jsxs)("div",{className:"relative md:hidden",children:[(0,a.jsx)("button",{type:"button",className:(0,o.cn)("absolute bottom-[100%] right-0 size-5 text-white"),onClick:e=>{e.stopPropagation(),k(!N)},children:(0,a.jsx)("span",{className:(0,o.cn)("i-hugeicons-arrow-down-01 transition-transform duration-300",N&&"rotate-180")})}),(0,a.jsx)("div",{className:(0,o.cn)("overflow-hidden transition-[max-height] duration-300 ease-in-out",N?"max-h-[320px]":"max-h-0"),children:b})]})]},l)},A=e=>{let{name:t,model:s,price:l,popularity:n,unit:r,description:i,uptime:o,radioChildren:c}=e,d=c?(0,a.jsx)(x.J,{htmlFor:s,className:"text-sm text-white font-normal",children:t}):(0,a.jsx)("div",{className:"text-sm text-white font-normal",children:t});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[null==c?void 0:c(s),d]}),(0,a.jsxs)("div",{className:"grid grow gap-2 mt-2.5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(w,{status:null!=o?o:0}),(0,a.jsx)(y,{price:l,unit:r})]}),(0,a.jsx)("div",{className:"flex items-center gap-1 text-sm text-white/50",children:n>0&&(0,a.jsx)(b.default,{src:2===n?N:k,alt:"model-popularity",width:24,height:24})})]}),(0,a.jsx)("div",{className:"flex flex-row gap-2 justify-between",children:(0,a.jsx)("p",{className:"text-sm text-white/50 text-ellipsis overflow-hidden min-h-5",children:i})})]})]})};var _=s(5888),S=s(30570),I=s(19703),M=s(56935);let L={light:"",dark:".dark"},P=d.createContext(null);function R(){let e=d.useContext(P);if(!e)throw Error("useChart must be used within a <ChartContainer />");return e}let D=d.forwardRef((e,t)=>{let{id:s,className:l,children:n,config:r,...i}=e,c=d.useId(),u="chart-".concat(s||c.replace(/:/g,""));return(0,a.jsx)(P.Provider,{value:{config:r},children:(0,a.jsxs)("div",{"data-chart":u,ref:t,className:(0,o.cn)("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",l),...i,children:[(0,a.jsx)(F,{id:u,config:r}),(0,a.jsx)(S.u,{children:n})]})})});D.displayName="Chart";let F=e=>{let{id:t,config:s}=e,l=Object.entries(s).filter(e=>{let[,t]=e;return t.theme||t.color});return l.length?(0,a.jsx)("style",{dangerouslySetInnerHTML:{__html:Object.entries(L).map(e=>{let[s,a]=e;return"\n".concat(a," [data-chart=").concat(t,"] {\n").concat(l.map(e=>{var t;let[a,l]=e,n=(null==(t=l.theme)?void 0:t[s])||l.color;return n?"  --color-".concat(a,": ").concat(n,";"):null}).join("\n"),"\n}\n")}).join("\n")}}):null},T=I.m,E=d.forwardRef((e,t)=>{let{active:s,payload:l,className:n,indicator:r="dot",hideLabel:i=!1,hideIndicator:c=!1,label:u,labelFormatter:m,labelClassName:h,formatter:x,color:g,nameKey:f,labelKey:p}=e,{config:b}=R(),v=d.useMemo(()=>{var e;if(i||!(null==l?void 0:l.length))return null;let[t]=l,s="".concat(p||t.dataKey||t.name||"value"),n=z(b,t,s),r=p||"string"!=typeof u?null==n?void 0:n.label:(null==(e=b[u])?void 0:e.label)||u;return m?(0,a.jsx)("div",{className:(0,o.cn)("font-medium",h),children:m(r,l)}):r?(0,a.jsx)("div",{className:(0,o.cn)("font-medium",h),children:r}):null},[u,m,l,i,h,b,p]);if(!s||!(null==l?void 0:l.length))return null;let j=1===l.length&&"dot"!==r;return(0,a.jsxs)("div",{ref:t,className:(0,o.cn)("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",n),children:[j?null:v,(0,a.jsx)("div",{className:"grid gap-1.5",children:l.map((e,t)=>{let s="".concat(f||e.name||e.dataKey||"value"),l=z(b,e,s),n=g||e.payload.fill||e.color;return(0,a.jsx)("div",{className:(0,o.cn)("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground","dot"===r&&"items-center"),children:x&&(null==e?void 0:e.value)!==void 0&&e.name?x(e.value,e.name,e,t,e.payload):(0,a.jsxs)(a.Fragment,{children:[(null==l?void 0:l.icon)?(0,a.jsx)(l.icon,{}):!c&&(0,a.jsx)("div",{className:(0,o.cn)("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":"dot"===r,"w-1":"line"===r,"w-0 border-[1.5px] border-dashed bg-transparent":"dashed"===r,"my-0.5":j&&"dashed"===r}),style:{"--color-bg":n,"--color-border":n}}),(0,a.jsxs)("div",{className:(0,o.cn)("flex flex-1 justify-between leading-none",j?"items-end":"items-center"),children:[(0,a.jsxs)("div",{className:"grid gap-1.5",children:[j?v:null,(0,a.jsx)("span",{className:"text-muted-foreground",children:(null==l?void 0:l.label)||e.name})]}),e.value&&(0,a.jsx)("span",{className:"font-mono font-medium tabular-nums text-foreground",children:e.value.toLocaleString()})]})]})},e.dataKey)})})]})});function z(e,t,s){if("object"!=typeof t||null===t)return;let a="payload"in t&&"object"==typeof t.payload&&null!==t.payload?t.payload:void 0,l=s;return s in t&&"string"==typeof t[s]?l=t[s]:a&&s in a&&"string"==typeof a[s]&&(l=a[s]),l in e?e[l]:e[s]}E.displayName="ChartTooltip",M.s,d.forwardRef((e,t)=>{let{className:s,hideIcon:l=!1,payload:n,verticalAlign:r="bottom",nameKey:i}=e,{config:c}=R();return(null==n?void 0:n.length)?(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center justify-center gap-4","top"===r?"pb-3":"pt-3",s),children:n.map(e=>{let t="".concat(i||e.dataKey||"value"),s=z(c,e,t);return(0,a.jsxs)("div",{className:(0,o.cn)("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[(null==s?void 0:s.icon)&&!l?(0,a.jsx)(s.icon,{}):(0,a.jsx)("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:e.color}}),null==s?void 0:s.label]},e.value)})}):null}).displayName="ChartLegend";var B=s(4017),O=s(36796),V=s(10238),H=s(75211),q=s(40124);let W={value:{color:"#0DCAFF"}};function U(e){let{data:t,...s}=e,l=(0,r.useTranslations)("chat.model.radar"),n=Object.entries(t).map(e=>{let[t,s]=e;return{type:l(t),value:s}});return(0,a.jsx)("div",{...s,children:(0,a.jsx)(D,{config:W,className:"w-full aspect-square",children:(0,a.jsxs)(B.V,{data:n,children:[(0,a.jsx)(T,{cursor:!1,content:(0,a.jsx)(E,{hideLabel:!0})}),(0,a.jsx)(O.z,{opacity:.3}),(0,a.jsx)(V.r,{dataKey:"type",tick:{fill:"#FFFFFF"}}),(0,a.jsx)(H.E,{domain:[0,10],tick:!1,axisLine:!1}),(0,a.jsx)(q.V,{dataKey:"value",fill:"var(--color-value)",fillOpacity:.6,dot:{r:4,fillOpacity:1}})]})})})}function K(e){let{seriesList:t,value:s,onChange:l,className:n,isDesktop:i=!1}=e,c=(0,r.useTranslations)("chat"),[u,x]=(0,d.useState)(null),[g,f]=(0,d.useState)(!1),[v,j]=(0,d.useState)(null),w=(0,d.useRef)(null),[y,A]=(0,d.useState)(!1),S=e=>{x(t=>t===e?null:e)},I=(e,t)=>{t.stopPropagation(),j(e),f(!0)};return(0,d.useEffect)(()=>{if(!i&&s&&t.length>0&&!y){let e=t.findIndex(e=>{var t;return null==(t=e.models)?void 0:t.some(e=>e.model===s)});-1!==e&&(x(e),A(!0),setTimeout(()=>{var e;let t=null==(e=w.current)?void 0:e.querySelector('[data-model="'.concat(s,'"]'));t&&t.scrollIntoView({behavior:"smooth",block:"center"})},300))}},[s,t,i,y]),(0,a.jsxs)("div",{className:(0,o.cn)(n),ref:w,children:[(0,a.jsx)(h.z,{className:"flex flex-col gap-2 bg-transparent",value:s,onValueChange:l,children:null==t?void 0:t.map((e,t)=>{let n=i||u===t;return(0,a.jsxs)("div",{className:"w-full rounded-xl ",children:[!i&&(0,a.jsx)("div",{className:"flex items-center justify-between cursor-pointer bg-[#2B2D33] p-3 rounded-xl w-full",onClick:()=>S(t),children:(0,a.jsxs)("div",{className:"flex flex-col text-white gap-2 w-full",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-between items-center w-full",children:[(0,a.jsxs)("div",{className:"inline-flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:e.series_name}),(0,a.jsxs)("div",{className:"flex flex-row items-center gap-1",children:[(0,a.jsx)("span",{className:"text-sm text-[#0DCAFF]",children:e.series_price_low===e.series_price_high?e.series_price_low:"".concat(e.series_price_low," ~ ").concat(e.series_price_high)}),(0,a.jsx)(b.default,{src:p.A.iconRuby,alt:"ruby",width:14,height:14})]}),(0,a.jsx)("button",{type:"button",onClick:t=>I(e,t),className:"flex items-center","aria-label":e.series_name,children:(0,a.jsx)(m.A.IconDetail,{className:"w-4 h-4 items-center mt-0.5"})})]}),(()=>{let t=Math.max(...e.models.map(e=>e.popularity||0));return t>0&&(0,a.jsx)(b.default,{src:2===t?N:k,alt:"series-popularity",width:16,height:16})})()]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-4 pr-4 relative",children:[(0,a.jsx)("span",{className:"text-xs text-white/50 line-clamp-none",children:e.series_description}),(0,a.jsx)("span",{className:(0,o.cn)("i-hugeicons-arrow-down-01 text-white transition-transform duration-300 w-4 h-4 items-center absolute right-0 bottom-0",n&&"rotate-180")})]})]})}),(0,a.jsx)("div",{className:(0,o.cn)(i?"flex flex-col gap-2":(0,o.cn)("overflow-hidden transition-all duration-300 ease-in-out",n?"max-h-[6000px] opacity-100":"max-h-0 opacity-0")),children:(0,a.jsx)("div",{className:(0,o.cn)("flex flex-col gap-2 transition-transform duration-300",!i&&"mt-2",n?"transform translate-y-0":"transform -translate-y-2"),children:e.models.map(e=>{var t,n,r,i,d;return(0,a.jsx)("div",{"data-model":e.model,className:(0,o.cn)("transition-all duration-300"),children:(0,a.jsx)(C,{active:s===e.model,name:e.name,model:e.model,price:e.price,isFree:null!=(t=e.is_free)&&t,isPlus:null!=(n=e.is_rubii_plus)&&n,unit:c("more.perMessage"),popularity:null!=(r=e.popularity)?r:0,description:null!=(i=e.description)?i:"",uptime:null!=(d=e.uptime)?d:0,onClick:()=>{l(e.model)}})},e.model)})})})]},e.series_name)})}),!i&&(0,a.jsx)(_._s,{open:g,onOpenChange:f,children:(0,a.jsxs)(_.zj,{className:"bg-[#1C1D1E] border-t border-white/10 z-[9999]",children:[(0,a.jsx)(_.BE,{className:"pb-0",children:(0,a.jsx)(_.gk,{className:"text-white text-center",children:null==v?void 0:v.series_name})}),(0,a.jsx)("div",{className:"px-4 pb-8 gap-2",children:v&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-1 py-2",children:[(0,a.jsx)("span",{className:"text-[#0DCAFF] text-base",children:v.series_price_low===v.series_price_high?v.series_price_low:"".concat(v.series_price_low," ~ ").concat(v.series_price_high)}),(0,a.jsx)(b.default,{src:p.A.iconRuby,alt:"ruby",width:16,height:16,className:"mt-0.5"})]}),(()=>{let e=Math.max(...v.models.map(e=>e.popularity||0));return e>0&&(0,a.jsx)(b.default,{src:2===e?N:k,alt:"series-popularity",width:16,height:16})})()]}),(0,a.jsx)("p",{className:"text-white/60 text-sm text-left mb-2",children:v.series_description})]}),(0,a.jsx)("div",{className:"bg-[#23242A] rounded-xl p-4",children:(0,a.jsx)(U,{data:v.series_ability})})]})})]})})]})}var Z=s(29391),$=s(41401),G=s(12127);function J(e){let{seriesList:t,historyLength:s,setHistoryLength:l,chooseModel:n,setChooseModel:i,topNValue:c,setTopNValue:d,isAdvancedMode:h,setIsAdvancedMode:g}=e,f=(0,r.useTranslations)("chat");return t&&0!==t.length?(0,a.jsxs)("div",{className:"flex flex-col space-y-4 h-full overflow-y-auto scrollbar-hide",children:[(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.J,{htmlFor:"memoryLength",className:"h-9 text-sm leading-none text-white font-normal flex-shrink-0 flex items-center justify-between gap-2 text-nowrap lg:min-w-40",children:(0,a.jsxs)("div",{className:"w-full flex justify-between items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.A.IconMemory,{className:"text-lg"}),(0,a.jsx)("span",{children:f("memoryLength")})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(Z.d,{checked:h,onCheckedChange:g,className:"data-[state=checked]:bg-h5-primary data-[state=unchecked]:bg-white/50"}),(0,a.jsx)("span",{className:"text-xs text-white/50",children:f("switchAdvancedMode")})]})]})}),(0,a.jsxs)("div",{className:"relative w-full rounded-xl flex flex-col gap-2 mb-4",children:[(0,a.jsx)("div",{className:(0,o.cn)("transition-opacity duration-300",h?"opacity-100 relative":"opacity-0 pointer-events-none absolute inset-0"),children:(0,a.jsxs)("div",{className:"bg-[#2B2D33] p-4 flex flex-col gap-2 rounded-xl",children:[(0,a.jsxs)(G.bL,{className:"relative flex items-center select-none touch-none w-full h-4",value:[c],min:8,max:200,step:4,onValueChange:e=>{d(e[0])},children:[(0,a.jsx)(G.CC,{className:"bg-white/20 relative flex-grow rounded-full h-1",children:(0,a.jsx)(G.Q6,{className:"absolute bg-h5-block-gradient rounded-full h-full"})}),(0,a.jsx)(G.zi,{asChild:!0,children:(0,a.jsx)("div",{className:"block size-5 bg-white shadow-[0_2px_10px] shadow-black/20 rounded-[10px] hover:bg-violet-100 focus:outline-none focus:shadow-[0_0_0_5px] focus:shadow-black/30 cursor-grab"})})]}),(0,a.jsxs)("div",{className:"flex justify-between text-xs text-white/50 font-medium mt-1",children:[(0,a.jsx)("span",{children:f("more.topNSize",{value:8})}),(0,a.jsx)("span",{children:f("more.topNSize",{value:200})})]}),(0,a.jsx)("div",{className:"text-center text-white text-base font-medium mt-1",children:f("more.willSee",{value:c})}),(0,a.jsxs)("div",{className:"text-center text-white/60 text-xs mt-1",children:[f("more.willSeeHint",{value:c/2,value2:c/2}),(0,a.jsx)("br",{}),f("more.uniqueAlgorithm")]})]})}),(0,a.jsx)("div",{className:(0,o.cn)("transition-opacity duration-300",h?"opacity-0 pointer-events-none absolute inset-0":"opacity-100 relative"),children:(0,a.jsx)("div",{className:"flex items-center gap-4 w-full",children:$.ge.map(e=>(0,a.jsx)(u.Ay,{wrapperClassName:(0,o.cn)("rounded-[9px] hover:bg-h5-block-gradient flex-1",s===e.value?"bg-h5-block-gradient":"bg-[#363A42]"),className:"h-9 rounded-lg bg-[#363A42] text-sm cursor-pointer flex items-center justify-center text-white",onClick:()=>{l(e.value)},"aria-label":"设置记忆长度为".concat(f(e.$label)),role:"button",tabIndex:0,children:f(e.$label)},e.value))})})]})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)(x.J,{htmlFor:"memoryLength",className:"h-9 text-sm leading-none text-white font-normal w-40 flex-shrink-0 flex items-center gap-2",children:[(0,a.jsx)(m.A.IconHostGroupFill,{className:"text-lg"}),(0,a.jsx)("span",{children:f("chooseModel")})]}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(K,{seriesList:t,value:n,onChange:i,className:"h-full"})})]})]}):(0,a.jsx)("div",{className:"flex flex-col items-center justify-center h-full text-white/60",children:(0,a.jsx)(m.A.IconSpinner,{className:"text-3xl mb-4 animate-spin"})})}function X(e){let{seriesList:t,historyLength:s,setHistoryLength:l,chooseModel:n,setChooseModel:i,topNValue:c,setTopNValue:d,isAdvancedMode:h,setIsAdvancedMode:g,activeSeries:f,setActiveSeriesName:p}=e,v=(0,r.useTranslations)("chat");return t&&0!==t.length?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex gap-2 w-full items-start mb-8",children:[(0,a.jsx)(x.J,{htmlFor:"memoryLength",className:"h-9 text-sm leading-none text-white font-normal flex-shrink-0 flex items-center gap-2 text-nowrap lg:min-w-40",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.A.IconMemory,{className:"text-lg"}),(0,a.jsx)("span",{children:v("memoryLength")})]})}),(0,a.jsxs)("div",{className:"relative flex flex-1 gap-4 mt-2 lg:mt-0 w-full",children:[(0,a.jsx)("div",{className:(0,o.cn)("transition-opacity duration-300",h?"opacity-0 pointer-events-none absolute inset-0 flex items-center gap-4 max-md:w-full":"opacity-100 relative flex items-center gap-4 max-md:w-full"),children:$.ge.map(e=>(0,a.jsx)(u.Ay,{wrapperClassName:(0,o.cn)("rounded-[9px] hover:bg-h5-block-gradient max-md:flex-1",s===e.value?"bg-h5-block-gradient":"bg-[#363A42]"),className:"h-9 md:w-20 rounded-lg bg-[#363A42] text-sm cursor-pointer flex items-center justify-center text-white",onClick:()=>{l(e.value)},"aria-label":"设置记忆长度为".concat(v(e.$label)),tabIndex:0,children:v(e.$label)},e.value))}),(0,a.jsxs)("div",{className:(0,o.cn)("transition-opacity duration-300",h?"opacity-100 relative flex flex-col gap-1.5 w-full lg:w-[450px]":"opacity-0 pointer-events-none absolute inset-0 flex flex-col gap-1.5 w-full lg:w-[450px]"),children:[(0,a.jsxs)(G.bL,{className:"relative flex items-center select-none touch-none w-full h-4",value:[c],min:8,max:200,step:4,onValueChange:e=>{d(e[0])},children:[(0,a.jsx)(G.CC,{className:"bg-white/20 relative flex-grow rounded-full h-1",children:(0,a.jsx)(G.Q6,{className:"absolute bg-h5-block-gradient rounded-full h-full"})}),(0,a.jsx)(G.zi,{asChild:!0,children:(0,a.jsx)("div",{className:"block size-5 bg-white shadow-[0_2px_10px] shadow-black/20 rounded-[10px] hover:bg-violet-100 focus:outline-none focus:shadow-[0_0_0_5px] focus:shadow-black/30 cursor-grab"})})]}),(0,a.jsxs)("span",{className:"flex w-full items-center justify-between gap-1 text-xs font-medium text-white/50","aria-hidden":"true",children:[(0,a.jsx)("span",{children:v("more.topNSize",{value:8})}),(0,a.jsx)("span",{children:v("more.topNSize",{value:200})})]}),(0,a.jsx)("div",{className:"text-center text-white text-base font-medium mt-1",children:v("more.willSee",{value:c})}),(0,a.jsxs)("div",{className:"text-center text-white/60 text-xs mt-1",children:[v("more.willSeeHint",{value:c/2,value2:c/2}),(0,a.jsx)("br",{}),v("more.uniqueAlgorithm")]})]})]}),(0,a.jsxs)("div",{className:"items-center gap-2 h-9 hidden lg:flex",children:[(0,a.jsx)(Z.d,{checked:h,onCheckedChange:g,className:"data-[state=checked]:bg-h5-primary data-[state=unchecked]:bg-white/50"}),(0,a.jsx)("span",{className:"text-xs text-white/50",children:v("switchAdvancedMode")})]})]}),(0,a.jsxs)("div",{className:(0,o.cn)("flex w-full flex-1 items-start",h?"h-[calc(100%-200px)]":"h-[calc(100%-80px)]"),children:[(0,a.jsx)("div",{className:"flex flex-col w-[160px] gap-2",children:(0,a.jsxs)(x.J,{htmlFor:"memoryLength",className:"h-9 text-sm leading-none text-white font-normal flex-shrink-0 flex items-center gap-2",children:[(0,a.jsx)(m.A.IconHostGroupFill,{className:"text-lg"}),(0,a.jsx)("span",{children:v("chooseModel")})]})}),(0,a.jsxs)("div",{className:"w-[calc(100%-160px)] flex flex-1 h-full",children:[(0,a.jsx)("div",{className:"flex flex-col w-1/2 h-full gap-2 overflow-y-auto scrollbar-hide mr-2",children:t.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsx)(u.Ay,{wrapperClassName:(0,o.cn)("rounded-[13px] hover:bg-h5-block-gradient",(null==f?void 0:f.series_name)===e.series_name?"bg-h5-block-gradient":"bg-[#363A42]"),className:(0,o.cn)("w-full rounded-xl bg-[#2B2D33] p-3 cursor-pointer",(null==f?void 0:f.series_name)===e.series_name&&"ring ring-h5-primary"),onClick:()=>p(e.series_name),"aria-label":"选择模型系列 ".concat(e.series_name),role:"button",tabIndex:0,children:(0,a.jsxs)("div",{className:"flex flex-col text-white gap-2",children:[(0,a.jsxs)("div",{className:"inline-flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:e.series_name}),(0,a.jsxs)("div",{className:"flex flex-row items-center gap-1",children:[(0,a.jsx)("span",{className:"text-sm text-[#0DCAFF]",children:e.series_price_low===e.series_price_high?e.series_price_low:"".concat(e.series_price_low," ~ ").concat(e.series_price_high)}),(0,a.jsx)(m.A.IconRuby,{className:"w-4 h-4"}),(()=>{let t=Math.max(...e.models.map(e=>e.popularity||0));return t>0&&(0,a.jsx)(b.default,{src:2===t?N:k,alt:"series-popularity",width:16,height:16})})()]})]}),(0,a.jsx)("span",{className:"text-xs text-white/50 line-clamp-2",children:e.series_description})]})}),(0,a.jsx)("div",{className:(0,o.cn)("overflow-hidden transition-all duration-300 ease-in-out",(null==f?void 0:f.series_name)===e.series_name?"max-h-[600px] opacity-100 mt-2 mb-2":"max-h-0 opacity-0"),children:(0,a.jsx)("div",{className:"bg-[#23242A] rounded-xl p-4",children:(0,a.jsx)(U,{data:e.series_ability})})})]},e.series_name))}),(0,a.jsx)("div",{className:"flex flex-col w-1/2 h-full gap-2 overflow-y-auto scrollbar-hide pr-2",children:f&&(0,a.jsx)("div",{className:"flex-1 flex flex-col gap-2 ml-4 overflow-y-auto scrollbar-hide",children:(0,a.jsx)(K,{seriesList:[f],value:n,onChange:i,className:"w-full",isDesktop:!0})})})]})]})]}):(0,a.jsx)("div",{className:"flex flex-col items-center justify-center h-full text-white/60",children:(0,a.jsx)(m.A.IconSpinner,{className:"text-3xl mb-4 animate-spin"})})}let Q=e=>{let{isMobile:t,className:s,...l}=e,n=(0,c.A)(e=>{var t;return null!=(t=e.historyLength)?t:"medium"}),r=(0,c.A)(e=>e.setHistoryLength),u=(0,c.A)(e=>e.modelList||[]),m=(0,c.A)(e=>e.chooseModel),h=(0,c.A)(e=>e.setChooseModel),x=(0,c.A)(e=>e.topNValue),g=(0,c.A)(e=>e.setTopNValue),f=(0,c.A)(e=>e.isAdvancedMode),p=(0,c.A)(e=>e.setIsAdvancedMode),b=(0,d.useMemo)(()=>Array.isArray(u)&&(0===u.length||u[0]&&"series_name"in u[0])?u:[],[u]),[v,j]=(0,d.useState)(()=>{var e,t,s;if(m&&b.length>0){for(let e of b)if(null==(t=e.models)?void 0:t.some(e=>e.model===m))return e.series_name}return null!=(s=null==(e=b[0])?void 0:e.series_name)?s:null}),w=(0,d.useMemo)(()=>{var e,t,s;return v&&b.length?null!=(s=null!=(t=b.find(e=>e.series_name===v))?t:b[0])?s:null:null!=(e=b[0])?e:null},[b,v]);return(0,d.useEffect)(()=>{var e,t,s,a;if(!v||!b.length)return void j(null!=(s=null==(t=b[0])?void 0:t.series_name)?s:null);b.find(e=>e.series_name===v)||j(null!=(a=null==(e=b[0])?void 0:e.series_name)?a:null)},[b,v]),(0,i.qt)(b,m,h),(0,a.jsx)("div",{className:(0,o.cn)("w-full p-2 lg:p-6 h-[calc(100%-51px)]",t?"space-y-4 overflow-y-auto scrollbar-hide":"flex flex-col h-full",s),...l,children:t?(0,a.jsx)(J,{seriesList:b,historyLength:n,setHistoryLength:r,chooseModel:m,setChooseModel:h,topNValue:x,setTopNValue:g,isAdvancedMode:f,setIsAdvancedMode:p}):(0,a.jsx)(X,{seriesList:b,historyLength:n,setHistoryLength:r,chooseModel:m,setChooseModel:h,topNValue:x,setTopNValue:g,isAdvancedMode:f,setIsAdvancedMode:p,activeSeries:w,setActiveSeriesName:j})})};var Y=s(55767);let ee=e=>{let{isMobile:t}=e,s=(0,r.useTranslations)("chat"),[i,o]=(0,n.fp)(Y.Z);return(0,a.jsx)(l.lG,{open:i.visible,onOpenChange:e=>{o({...i,visible:e})},children:(0,a.jsxs)(l.Cf,{className:"w-[100vw] h-[100dvh] bg-h5-background md:max-w-6xl md:h-[94dvh] md:rounded-2xl md:overflow-hidden block text-white z-[9999]",children:[(0,a.jsxs)(l.c7,{className:"py-4 border-b border-border/10",children:[(0,a.jsx)(l.L3,{className:"text-center font-normal",children:s("chatSettings")}),(0,a.jsx)(l.rr,{className:"hidden",children:s("chatSettings")})]}),(0,a.jsx)(Q,{isMobile:t,className:"h-[calc(100%-51px)] overflow-y-auto scrollbar-hide"})]})})}},38759:(e,t,s)=>{"use strict";s.d(t,{i:()=>i});var a=s(53400),l=s(87133),n=s(92380),r=s(18168);let i=e=>{let{isSelect:t,className:s,...i}=e;return(0,a.jsx)("div",{className:(0,n.cn)("absolute top-1/2 -translate-y-1/2 left-2 z-10 flex items-center justify-center",s),...i,children:(0,a.jsx)(r.bL,{className:(0,n.cn)("flex items-center justify-center size-5 border border-white rounded-full hover:bg-white/10 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-h5-primary data-[state=checked]:border-h5-primary"),checked:t,children:(0,a.jsx)(r.C1,{className:(0,n.cn)("size-3.5 flex items-center justify-center text-current pt-[1.5px]"),children:(0,a.jsx)(l.i,{})})})})}},41859:(e,t,s)=>{Promise.resolve().then(s.bind(s,81133)),Promise.resolve().then(s.bind(s,43457)),Promise.resolve().then(s.bind(s,88926)),Promise.resolve().then(s.bind(s,35743)),Promise.resolve().then(s.bind(s,40965)),Promise.resolve().then(s.bind(s,65811)),Promise.resolve().then(s.bind(s,3666)),Promise.resolve().then(s.bind(s,21833)),Promise.resolve().then(s.bind(s,37258)),Promise.resolve().then(s.bind(s,90885)),Promise.resolve().then(s.bind(s,45813)),Promise.resolve().then(s.bind(s,88301)),Promise.resolve().then(s.bind(s,93621)),Promise.resolve().then(s.t.bind(s,98016,23)),Promise.resolve().then(s.bind(s,58700)),Promise.resolve().then(s.bind(s,83271)),Promise.resolve().then(s.bind(s,67991)),Promise.resolve().then(s.t.bind(s,51093,23)),Promise.resolve().then(s.t.bind(s,42090,23)),Promise.resolve().then(s.bind(s,15035)),Promise.resolve().then(s.bind(s,5293)),Promise.resolve().then(s.bind(s,63559)),Promise.resolve().then(s.bind(s,78515)),Promise.resolve().then(s.bind(s,84369)),Promise.resolve().then(s.bind(s,85612)),Promise.resolve().then(s.bind(s,96317)),Promise.resolve().then(s.bind(s,85261)),Promise.resolve().then(s.bind(s,69062)),Promise.resolve().then(s.bind(s,7498)),Promise.resolve().then(s.bind(s,90153)),Promise.resolve().then(s.bind(s,30757)),Promise.resolve().then(s.bind(s,41918)),Promise.resolve().then(s.bind(s,93174)),Promise.resolve().then(s.bind(s,46644)),Promise.resolve().then(s.bind(s,70827)),Promise.resolve().then(s.bind(s,43619)),Promise.resolve().then(s.bind(s,97309)),Promise.resolve().then(s.bind(s,899)),Promise.resolve().then(s.bind(s,86189)),Promise.resolve().then(s.bind(s,59741)),Promise.resolve().then(s.bind(s,36854)),Promise.resolve().then(s.bind(s,30723)),Promise.resolve().then(s.bind(s,7494)),Promise.resolve().then(s.bind(s,71770)),Promise.resolve().then(s.bind(s,96613)),Promise.resolve().then(s.bind(s,18869)),Promise.resolve().then(s.bind(s,79142)),Promise.resolve().then(s.bind(s,70845)),Promise.resolve().then(s.bind(s,48902)),Promise.resolve().then(s.bind(s,15635)),Promise.resolve().then(s.bind(s,71141))},48902:(e,t,s)=>{"use strict";s.d(t,{ResponsiveBackgroundImage:()=>o});var a=s(53400),l=s(48276),n=s(38620),r=s(36405);function i(e){let{src:t,alt:s,quality:l,priority:i,sizes:o,className:c,fill:d,...u}=e,m=(0,n.LoaderWithAnimation)(!1);return(0,a.jsx)(r.default,{src:t,alt:s,quality:l,priority:i,sizes:o,className:c,fill:d,loader:m,...u})}function o(e){let[t,s]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{let e=window.matchMedia("(min-width: 1024px)"),t=()=>{s(e.matches)};return t(),e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}},[]),t)?(0,a.jsx)(i,{...e}):null}},53395:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(53400),l=s(92380),n=s(7626);function r(e){let{title:t,headerHeight:s=48,showHeader:r=!0,headerExtra:i,backgroundImage:o,fitMenu:c=!1,headerClassName:d,headerWrapperClassName:u,contentClassName:m,closeChildren:h,showClose:x=!0,onClose:g,defaultCloseBack:f=!1,children:p}=e;return(0,a.jsxs)("main",{className:"w-full h-full bg-h5-background relative text-h5-foreground",style:{"--h5-layout-header-height":"".concat(s,"px")},children:[o,r&&(0,a.jsx)("section",{className:(0,l.cn)("sticky top-0 left-0 right-0  h-[var(--h5-layout-header-height)] z-[1]",o?"bg-gradient-to-b from-[rgba(13,14,32,0.6)] via-[rgba(13,14,32,0.4)] to-transparent":"bg-h5-card-background/30 backdrop-blur-md",u),children:(0,a.jsx)(n.A,{className:(0,l.cn)("h-full px-2 mx-auto",d),title:t,extra:i,fitMenu:c,showClose:x,onClose:g,defaultCloseBack:f,closeChildren:h})}),(0,a.jsx)("section",{className:(0,l.cn)("w-full relative overflow-y-auto",r&&"h-[calc(100%-var(--h5-layout-header-height))]",m),children:p})]})}},54650:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a={src:"/_next/static/media/send.d1a5ddd5.svg",height:32,width:32,blurWidth:0,blurHeight:0}},55767:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(72197).eU)({visible:!1})},57076:(e,t,s)=>{"use strict";s.d(t,{V:()=>l});var a=s(99234);let l={sessionId:a.tU.withDefault("")};(0,a.Eq)(l)},57354:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a={src:"/_next/static/media/brief.fb891e5e.svg",height:28,width:28,blurWidth:0,blurHeight:0}},59741:(e,t,s)=>{"use strict";s.d(t,{default:()=>y});var a=s(53400),l=s(97308),n=s(7626),r=s(63058),i=s(92380),o=s(28235),c=s(10190),d=s(3666),u=s(16190),m=s(48276),h=s(23785),x=s(27333),g=s(19565),f=s(69328),p=s(19178),b=s(41887),v=s(16720),j=s(19590);let w=e=>{let{momentId:t,momentName:s,isMobile:l,className:n,onSelectMode:r,...o}=e,c=(0,u.useTranslations)(),[w,y]=(0,m.useState)(!1),[N,k]=(0,m.useState)(null),{downloadByUrl:C}=(0,v.m)(),A=(0,d.useMutation)({mutationFn:j.CT,onError:e=>{console.error(e),h.oR.error(c("global.shareFailed"))}}),_=(0,m.useCallback)(async()=>{try{let e=await A.mutateAsync(t);if(!e)return;k({link:null==e?void 0:e.link,image:null==e?void 0:e.image_url,cta:null==e?void 0:e.cta}),y(!0)}catch(e){console.error(e)}},[t,A]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.G,{isMobile:l,loading:A.isPending,open:w,onOpenChange:e=>{y(e),e||k(null)},image:null==N?void 0:N.image,link:null==N?void 0:N.link,cta:null==N?void 0:N.cta,shareTitle:s,onDownload:async()=>{(null==N?void 0:N.image)&&await C("rubii-".concat(s,"-").concat(Date.now(),".webp"),N.image)},cardTools:{showImage:!0,showCopy:!0,extra:(0,a.jsxs)("li",{className:"flex flex-col items-center gap-1.5",children:[(0,a.jsx)(b.$,{size:"icon",className:"bg-h5-input rounded-full size-12 text-2xl border border-transparent hover:border-border/20",onClick:()=>{y(!1),r()},children:(0,a.jsx)(g.o,{})}),(0,a.jsx)("span",{className:"text-xs",children:c("chat.share.session")})]})}}),(0,a.jsx)("button",{type:"button",className:(0,i.cn)("size-7 flex items-center justify-center text-2xl disabled:opacity-50 disabled:cursor-not-allowed",n),...o,disabled:A.isPending,onClick:_,children:A.isPending?(0,a.jsx)(p.X,{}):(0,a.jsx)(f.V,{})})]})},y=e=>{let{children:t,momentData:s,isMobile:d}=e,{openSelectMode:u}=(0,o.PC)(),m=(0,c.A)(e=>e.showRight),h=(0,c.A)(e=>e.setShowRight);return(0,a.jsxs)("div",{className:(0,i.cn)("relative",!m&&"overflow-hidden"),children:[(0,a.jsx)(l.N,{children:(0,a.jsx)(r.U,{initial:{opacity:0,x:"100%"},animate:{opacity:+!!m,x:m?0:"100%"},transition:{duration:.1},className:"fixed lg:absolute left-0 lg:left-auto top-0 right-0 h-[100dvh] lg:h-full w-screen lg:w-[408px] bg-[#1C1D1E] md:pt-16 text-sm text-white z-50 lg:z-10",children:(0,a.jsxs)("div",{className:"h-full overflow-y-hidden scrollbar-hide overflow-x-hidden",children:[(0,a.jsx)(n.A,{className:"px-2 h-12 lg:hidden",closeChildren:(0,a.jsx)("button",{type:"button",onClick:()=>h(!1),className:"flex items-center justify-center text-3xl size-7",children:(0,a.jsx)("span",{className:"i-hugeicons-arrow-left-01"})}),extra:(0,a.jsx)(w,{momentId:s._id,momentName:s.name,isMobile:d,onSelectMode:()=>{h(!1),u()}})}),t]})})}),(0,a.jsx)(r.U,{initial:{width:0},animate:{width:408*!!m},transition:{duration:.1},className:"overflow-hidden hidden lg:block",children:(0,a.jsx)("div",{className:"w-full lg:w-[408px]"})})]})}},63058:(e,t,s)=>{"use strict";s.d(t,{U:()=>a});let a=s(12292).P.div},70827:(e,t,s)=>{"use strict";s.d(t,{AnimatedImage:()=>d});var a=s(53400),l=s(38620),n=s(28235),r=s(1233),i=s(36405);let o=(0,l.LoaderWithAnimation)(!0),c=(0,l.LoaderWithAnimation)(!1);function d(e){let[t]=(0,r.fp)(n.qb);return t?(0,a.jsx)(i.default,{...e,alt:e.alt||"",loader:o}):(0,a.jsx)(i.default,{...e,alt:e.alt||"",loader:c})}},70845:(e,t,s)=>{"use strict";s.d(t,{default:()=>m});var a=s(53400),l=s(50122),n=s(90452),r=s(19590),i=s(92380),o=s(28235),c=s(10190),d=s(3666);let u=s(48276).memo(e=>{let t=(0,c.A)(e=>e.momentData)||e.momentData,{openSelectMode:s}=(0,o.PC)(),{mutate:u}=(0,d.useMutation)({mutationFn:r.mG,onError:e=>{console.error(e),c.A.setState({momentData:{...t,is_liked:!t.is_liked}})}}),m=(0,c.A)(e=>e.showRight),h=(0,c.A)(e=>e.setShowRight);return(0,a.jsxs)("section",{className:(0,i.cn)("z-30 absolute top-5 flex gap-2 md:gap-4 transition-all duration-300 ease-in-out right-0 max-lg:top-3",m?"lg:right-4":"lg:right-[84px]"),children:[(0,a.jsx)(n.H,{className:"hidden md:block transition-colors hover:bg-[rgba(102,112,128,0.80)]"}),(0,a.jsxs)("button",{type:"button",onClick:()=>{c.A.setState({momentData:{...t,is_liked:!t.is_liked}}),u(t._id)},className:"flex items-center justify-center rounded-lg cursor-pointer  lg:size-10 transition-colors  lg:bg-[rgba(102,112,128,0.60)]  lg:hover:bg-[rgba(102,112,128,0.80)]  lg:backdrop-blur-[15px] size-6 text-xl",children:[(0,a.jsx)(l.A.IconLike,{className:(0,i.cn)("absolute inset-0 transition-opacity duration-300 text-white/80",t.is_liked?"opacity-0":"opacity-100","lg:translate-y-1/2 lg:translate-x-1/2 mt-[2.5px] lg:mt-0")}),(0,a.jsx)(l.A.IconLikeFill,{className:(0,i.cn)("absolute inset-0 transition-opacity duration-300 text-red-500",t.is_liked?"opacity-100":"opacity-0","lg:translate-y-1/2 lg:translate-x-1/2 mt-[2.5px] lg:mt-0")})]}),(0,a.jsx)("button",{type:"button",className:"flex size-10 items-center justify-center rounded-lg transition-colors bg-[rgba(102,112,128,0.60)] hover:bg-[rgba(102,112,128,0.80)] backdrop-blur-[15px] max-lg:hidden cursor-pointer text-xl",onClick:()=>s(),children:(0,a.jsx)(l.A.IconShare,{})}),(0,a.jsx)("button",{type:"button",onClick:()=>{h(!m)},className:"flex items-center justify-center rounded-lg cursor-pointer lg:h-10 lg:w-10 lg:hidden size-6 text-xl",children:(0,a.jsx)(l.A.IconMoreVertical,{})})]})});u.displayName="ChatActions";let m=u},71022:(e,t,s)=>{"use strict";s.d(t,{B:()=>l});var a=s(48276);function l(e,t){let{onSuccess:s,onError:l}=t,n=(0,a.useRef)(s),r=(0,a.useRef)(l);return(0,a.useEffect)(()=>{n.current=s,r.current=l},[s,l]),(0,a.useEffect)(()=>{e.data&&n.current&&n.current(e.data)},[e.data]),(0,a.useEffect)(()=>{e.error&&r.current&&r.current(e.error)},[e.error]),{data:e.data,error:e.error,isFetching:e.isFetching,refetch:e.refetch}}},71770:(e,t,s)=>{"use strict";s.d(t,{ChatExtra:()=>o});var a=s(79143),l=s(37070),n=s(28235),r=s(1233),i=s(48276);let o=e=>{let{audioUrl:t}=e,{play:s,isPlaying:o,clean:c}=(0,a.f)(),[d]=(0,r.fp)(n.f1);return(0,i.useEffect)(()=>{if(!t||!d)return;let e=["click","touchstart","keydown"],a=()=>{d&&!o&&t&&s(t,{loop:!0}).catch(()=>{}),e.forEach(e=>{document.removeEventListener(e,a)})};return e.forEach(e=>{document.addEventListener(e,a,{once:!0})}),()=>{e.forEach(e=>{document.removeEventListener(e,a)})}},[t,d,o,s]),(0,l.i)(()=>{c()}),null}},77696:(e,t,s)=>{"use strict";s.d(t,{OU:()=>m,SC:()=>h});var a=s(53400),l=s(83572),n=s(32361),r=s(16190),i=s(48276),o=s(98169);let c=i.createContext(()=>Promise.resolve(null)),d="Okay";function u(e,t){switch(t.type){case"close":return{...e,open:!1};case"alert":case"confirm":case"prompt":return{...e,open:!0,...t,cancelButton:t.cancelButton||("alert"===t.type?d:"Cancel"),actionButton:"actionButton"in t&&t.actionButton||d,cancelButtonVariant:t.cancelButtonVariant||"default",actionButtonVariant:"actionButtonVariant"in t&&t.actionButtonVariant||"default"};default:return e}}function m(e){let{children:t}=e,s=(0,r.useTranslations)("global"),[d,m]=i.useReducer(u,{open:!1,title:"",body:"",type:"alert",cancelButton:s("cancel"),actionButton:s("confirm"),cancelButtonVariant:"default",actionButtonVariant:"default"}),h=i.useRef(null);function x(){var e;m({type:"close"}),null==(e=h.current)||e.call(h,!1)}let g=i.useCallback(async e=>(m(e),new Promise(e=>{h.current=e})),[]);return(0,a.jsxs)(c.Provider,{value:g,children:[t,(0,a.jsx)(l.Lt,{open:d.open,onOpenChange:e=>{e||x()},children:(0,a.jsx)(l.EO,{className:"max-w-md text-white border-none rounded-xl px-4 bg-transparent",children:(0,a.jsxs)("form",{className:"bg-card-background rounded-xl p-6",onSubmit:e=>{var t,s,a;e.preventDefault(),s=null==(t=e.currentTarget.prompt)?void 0:t.value,m({type:"close"}),null==(a=h.current)||a.call(h,null==s||s)},children:[(0,a.jsxs)(l.wd,{children:[(0,a.jsx)(l.r7,{className:"font-normal",children:d.title}),d.body?(0,a.jsx)(l.$v,{className:"text-white mt-6",children:d.body}):null]}),"prompt"===d.type&&(0,a.jsx)(n.p,{name:"prompt",defaultValue:d.defaultValue,...d.inputProps}),(0,a.jsxs)(l.ck,{className:"mt-8 gap-3",children:[(0,a.jsx)(o.Ay,{wrapperClassName:"h-9 cursor-pointer",onClick:x,className:"px-6 bg-card-background flex items-center justify-center text-sm hover:bg-card-background/80 transition-colors",children:d.cancelButton}),"alert"===d.type?null:(0,a.jsx)("button",{type:"submit",className:"bg-h5-block-gradient h-9 px-6 rounded-lg font-normal",children:d.actionButton})]})]})})})]})}function h(){let e=i.useContext(c);return i.useCallback(t=>e({..."string"==typeof t?{title:t}:t,type:"confirm"}),[e])}},79142:(e,t,s)=>{"use strict";s.d(t,{default:()=>x});var a=s(53400),l=s(57354),n=s(42283),r=s(92380),i=s(28235),o=s(10190),c=s(16190),d=s(36405),u=s(48276),m=s(46639);let h=(0,u.memo)(e=>{let{name:t,description:s,ref:u,className:h,style:x}=e,g=(0,c.useTranslations)("chat"),f=(0,o.A)(e=>e.userData),[p]=(0,i.lh)();return(0,a.jsxs)("div",{className:(0,r.cn)("relative text-lg w-full rounded-[8px] flex-shrink-0 overflow-hidden pb-4 pt-3.5 ml-1 mr-1",h,!p&&"lg:pt-60"),ref:u,style:x,children:[(0,a.jsxs)("section",{className:"flex space-x-1",children:[(0,a.jsx)(d.default,{src:l.default,alt:"brief",width:26,height:26}),(0,a.jsx)("h2",{className:"bg-[linear-gradient(90deg,_#0FF_3.47%,_#FFD600_82.5%)] bg-clip-text text-transparent text-fill-transparent [-webkit-background-clip:text] [-webkit-text-fill-color:transparent]",children:g("memoryBrief")})]}),(0,a.jsx)("h3",{children:(0,a.jsx)(n.V,{className:"text-[14px] font-normal leading-normal mt-2",content:(0,m.Y1)({str:s,char:t,user:(null==f?void 0:f.name)||"user"})})})]})});h.displayName="TopMemory";let x=h},79143:(e,t,s)=>{"use strict";s.d(t,{f:()=>l});var a=s(48276);function l(e){let t=(0,a.useRef)(null),[s,l]=(0,a.useState)(!1),n=(0,a.useRef)(null),r=(0,a.useRef)(null);return{play:async(s,a)=>{let{loop:i=!1}=a||{};try{if(!t.current){let a=s instanceof File?URL.createObjectURL(s):s;n.current=a,r.current=a,t.current=new Audio(a),t.current.loop=i,await t.current.load(),t.current.addEventListener("ended",()=>{if(!i||r.current!==n.current){var t;l(!1),null==e||null==(t=e.onEnd)||t.call(e),s instanceof File&&URL.revokeObjectURL(a)}})}t.current.readyState<2&&await new Promise(e=>{t.current&&t.current.addEventListener("canplay",e,{once:!0})}),await t.current.play(),l(!0)}catch(e){console.error("播放音频失败:",e),l(!1)}},pause:()=>{t.current&&(t.current.pause(),l(!1))},stop:()=>{t.current&&(t.current.pause(),t.current.currentTime=0,l(!1))},clean:()=>{l(!1),t.current&&(t.current.pause(),t.current.currentTime=0,n.current&&(URL.revokeObjectURL(n.current),n.current=null),t.current=null)},isPlaying:s}}},81909:(e,t,s)=>{"use strict";s.d(t,{l:()=>i});var a=s(23785),l=s(79896),n=s(10190),r=s(16310);function i(e,t){let s=/%%%ERROR%%%(.*)/;if(s.test(e)){var i;let l=null==(i=e.match(s))?void 0:i[1];a.oR.warning(l||""),n.A.getState().setIsSending(!1),n.A.getState().setIsReceiving(!1),t?t():(0,r.t)()}else n.A.setState(t=>{let s=[...t.chatData],a=(0,l.Kl)(s,e=>"ai"===e.role);return -1!==a&&(s[a]={...s[a],text:s[a].text+e}),{chatData:s}})}},83572:(e,t,s)=>{"use strict";s.d(t,{$v:()=>f,EO:()=>m,Lt:()=>o,Rx:()=>p,ck:()=>x,r7:()=>g,tv:()=>c,wd:()=>h});var a=s(53400),l=s(77954),n=s(48276),r=s(41887),i=s(92380);let o=l.bL,c=l.l9,d=l.ZL,u=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.hJ,{className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...n,ref:t})});u.displayName=l.hJ.displayName;let m=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsxs)(d,{children:[(0,a.jsx)(u,{}),(0,a.jsx)(l.UC,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...n,onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""}})]})});m.displayName=l.UC.displayName;let h=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...s})};h.displayName="AlertDialogHeader";let x=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};x.displayName="AlertDialogFooter";let g=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold",s),...n})});g.displayName=l.hE.displayName;let f=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",s),...n})});f.displayName=l.VY.displayName;let p=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.rc,{ref:t,className:(0,i.cn)((0,r.r)(),s),...n})});p.displayName=l.rc.displayName,n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(l.ZD,{ref:t,className:(0,i.cn)((0,r.r)({variant:"outline"}),"mt-2 sm:mt-0",s),...n})}).displayName=l.ZD.displayName},84369:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a={src:"/_next/static/media/chat-icon.657a0009.svg",height:16,width:16,blurWidth:0,blurHeight:0}},84467:(e,t,s)=>{"use strict";s.d(t,{b:()=>l});var a=s(9589);let l=(e,t,s)=>{(0,a.sendGTMEvent)({event:e,...t},s)}},86189:(e,t,s)=>{"use strict";s.d(t,{default:()=>ee});var a=s(53400),l=s(16190),n=s(67569),r=s(48276);let i=r.memo(function(e){return(0,a.jsxs)("svg",{width:"1em",height:"1em",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",fill:"none",...e,children:[(0,a.jsx)("title",{children:"comment"}),(0,a.jsx)("path",{d:"M20.6 10.8C20.6 12.1103 20.3136 13.3538 19.8 14.4712C19.397 15.3479 23 19.6 23 19.6C23 19.6 16.5041 18.3252 15.4712 18.8C14.3538 19.3136 13.1103 19.6 11.8 19.6C6.93989 19.6 3 15.6601 3 10.8C3 5.93989 6.93989 2 11.8 2C16.6601 2 20.6 5.93989 20.6 10.8Z",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})]})}),o=r.memo(function(e){return(0,a.jsxs)("svg",{width:"1em",height:"1em",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",fill:"none",...e,children:[(0,a.jsx)("title",{children:"moment"}),(0,a.jsx)("path",{d:"M8.00037 1.99854C8.30719 1.99854 8.55592 2.24727 8.55592 2.55409V4.22076C8.55592 5.39227 9.46245 6.35205 10.6123 6.43688L10.7781 6.44298C12.0054 6.44298 13.0004 5.44806 13.0004 4.22076V2.55409C13.0004 2.24727 13.2491 1.99854 13.5559 1.99854H17.3504C17.9027 1.99854 18.3504 2.44625 18.3504 2.99854L18.3503 7.58132C18.3503 7.71623 18.4597 7.8256 18.5946 7.8256L18.6552 7.81796L18.7121 7.79552C19.2072 7.52407 19.7746 7.3695 20.3254 7.3695C21.8027 7.3695 23.0004 8.48184 23.0004 9.97898C23.0004 11.4761 21.8027 12.5885 20.3254 12.5885C19.863 12.5885 19.3888 12.5109 18.9555 12.336L18.7425 12.2404C18.6083 12.1737 18.4454 12.2284 18.3787 12.3626C18.36 12.4002 18.3503 12.4415 18.3503 12.4834L18.3504 16.5541C18.3504 17.0639 17.9689 17.4846 17.4758 17.5463L17.3504 17.5541L13.3031 17.5542C12.9076 17.5543 12.6356 17.9573 12.7659 18.3308C12.9372 18.8218 13.1201 19.4267 13.1201 19.7711C13.1201 21.1985 12.0531 21.9985 10.7781 21.9985C9.50318 21.9985 8.43982 21.2772 8.43982 19.8497C8.43982 19.4947 8.63315 18.839 8.80784 18.3191C8.93239 17.9484 8.66092 17.5543 8.26987 17.5542L4.00037 17.5541C3.44808 17.5541 3.00037 17.1064 3.00037 16.5541V2.99854C3.00037 2.44625 3.44808 1.99854 4.00037 1.99854H8.00037Z",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})]})});var c=s(27951);let d={src:"/_next/static/media/memory-length.96981f28.svg",height:16,width:16,blurWidth:0,blurHeight:0},u={src:"/_next/static/media/model.99624c41.svg",height:16,width:16,blurWidth:0,blurHeight:0},m={src:"/_next/static/media/auto-scroll.28bbf25e.svg",height:16,width:16,blurWidth:0,blurHeight:0},h={src:"/_next/static/media/full-screen.0bbe8277.svg",height:16,width:16,blurWidth:0,blurHeight:0},x=r.memo(function(e){return(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",...e,children:[(0,a.jsx)("title",{children:"auto-play"}),(0,a.jsx)("path",{stroke:"#fff",strokeLinecap:"round",strokeLinejoin:"round",d:"M4.19 14.66a2.08 2.08 0 1 0 0-4.16 2.08 2.08 0 0 0 0 4.16Z"}),(0,a.jsx)("path",{stroke:"#fff",strokeLinecap:"round",strokeLinejoin:"round",d:"M13.9 11.2V3.06c0-1.73-1.1-1.97-2.2-1.67L7.56 2.52c-.76.21-1.28.81-1.28 1.68V12.58"}),(0,a.jsx)("path",{stroke:"#fff",strokeLinecap:"round",strokeLinejoin:"round",d:"M11.81 13.28a2.08 2.08 0 1 0 0-4.16 2.08 2.08 0 0 0 0 4.16ZM6.27 6.35l7.62-2.08"})]})}),g=r.memo(function(e){return(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",...e,children:[(0,a.jsx)("title",{children:"video"}),(0,a.jsx)("path",{stroke:"#fff",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",d:"M14.67 10V6c0-3.33-1.34-4.67-4.67-4.67H6C2.67 1.33 1.33 2.67 1.33 6v4c0 3.33 1.34 4.67 4.67 4.67h4c3.33 0 4.67-1.34 4.67-4.67ZM1.68 4.74h12.64M5.68 1.4v3.25M10.32 1.4v2.95"}),(0,a.jsx)("path",{stroke:"#fff",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",d:"M6.5 9.64v-.8c0-1.03.73-1.45 1.61-.94l.7.4.69.4c.89.52.89 1.36 0 1.87l-.7.4-.69.4c-.88.51-1.61.1-1.61-.93v-.8 0Z"})]})});var f=s(29391),p=s(55767),b=s(41401),v=s(92380),j=s(28235),w=s(10190),y=s(1233),N=s(21005),k=s(36405),C=s(23785),A=s(77696);let _=r.memo(function(e){return(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",...e,children:[(0,a.jsx)("title",{children:"refresh"}),(0,a.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M8.0004 3.5c-1.0146 0-1.9401.3286-2.6858.8856a.5017.5017 0 0 1-.0189.0134l-.0003.0003-.0012.0008c-.0001 0-.0003.0001-.2788-.4151l.2785.4152.0003-.0001-.0003.0002-.015.0107a2.1197 2.1197 0 0 0-.0704.054 3.8286 3.8286 0 0 0-.2727.2411c-.2294.2216-.5375.5656-.8372 1.0442a.516.516 0 0 1-.0071.011C3.714 6.4186 3.5 7.1833 3.5 8a.5.5 0 0 1-1 0c0-.9988.2636-1.94.7321-2.7503a.5143.5143 0 0 1 .0193-.0307c.3487-.5568.7108-.9627.9895-1.232a4.8236 4.8236 0 0 1 .3449-.3045 3.119 3.119 0 0 1 .1353-.1019l.0028-.002C5.637 2.8992 6.7685 2.5 8.0004 2.5c1.816 0 3.1754.759 4.0709 1.506.1566.1307.2995.2613.4287.388V3.28a.5.5 0 0 1 1 0v2.4774a.4998.4998 0 0 1-.2427.4516.4975.4975 0 0 1-.2651.071H10.78a.5.5 0 0 1 0-1h1.1888a6.2363 6.2363 0 0 0-.5381-.506C10.66 4.131 9.5195 3.5 8.0004 3.5ZM13.5 8a.5.5 0 0 0-1 0 4.4833 4.4833 0 0 1-.6028 2.2497l-.0005.0008c-.244.3934-.5378.7272-.7781.9677a5.7826 5.7826 0 0 1-.3075.2868 4.2973 4.2973 0 0 1-.0864.0726l-.021.0168-.0033.0026a4.482 4.482 0 0 1-2.7007.9017c-1.2064 0-2.2026-.6081-2.9216-1.2603a6.8339 6.8339 0 0 1-.5135-.5196h1.25a.5.5 0 0 0 0-1h-2.26a.5.5 0 0 0-.4996.5176V12.72a.5.5 0 0 0 1 0v-1.0808c.1081.1115.2253.2256.3513.3399.8135.7378 2.0397 1.5196 3.5934 1.5196a5.482 5.482 0 0 0 3.3061-1.1058l.0041-.0031-.3052-.3961c.3052.3961.3052.3961.3053.396l.0002-.0001.0004-.0004.001-.0008.003-.0023.0093-.0073a4.4281 4.4281 0 0 0 .1406-.1169 6.7903 6.7903 0 0 0 .3615-.3368c.2864-.2867.6534-.7025.9582-1.2092a.5068.5068 0 0 0 .0261-.0493A5.4829 5.4829 0 0 0 13.5 8Z",clipRule:"evenodd"})]})}),S=r.memo(function(e){return(0,a.jsxs)("svg",{className:e.className,xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 16 16",fill:"none",...e,children:[(0,a.jsx)("title",{children:"replace"}),(0,a.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M7.5013.9559a.5.5 0 0 1 .0488.7054L6.614 2.7368a7.0687 7.0687 0 0 1 1.3858-.1372c3.4695 0 6.28 2.8105 6.28 6.28s-2.8105 6.28-6.28 6.28-6.28-2.8105-6.28-6.28c0-1.289.3913-2.4917 1.0573-3.4907a.5.5 0 0 1 .832.5547 5.2795 5.2795 0 0 0-.8893 2.936c0 2.9172 2.3628 5.28 5.28 5.28 2.9172 0 5.28-2.3628 5.28-5.28 0-2.9172-2.3628-5.28-5.28-5.28-.5615 0-1.0783.0775-1.5557.202l1.3438.981a.5.5 0 1 1-.5896.8076l-2.2467-1.64a.4981.4981 0 0 1-.2006-.336.5.5 0 0 1 .1183-.3961L6.796 1.0047A.5.5 0 0 1 7.5013.956Z",clipRule:"evenodd"})]})});var I=s(19178),M=s(7429),L=s(31119),P=s(90885),R=s(3666);let D=e=>{let{momentId:t,onClose:s,className:n,...i}=e,o=(0,l.useTranslations)(),c=(0,A.SC)(),[d,u]=(0,r.useState)({name:"",persona:""}),m=(0,P.useQuery)({queryKey:["momentPersona",t],queryFn:()=>(0,L.FC)(t),enabled:!!t}),h=(0,r.useMemo)(()=>!!m.data&&(d.name!==m.data.name||d.persona!==m.data.persona),[m.data,d]);(0,r.useEffect)(()=>{m.data&&u({name:m.data.name,persona:m.data.persona})},[m.data]);let x=(0,R.useMutation)({mutationFn:e=>(0,L.OS)(t,e),onSuccess:()=>{m.refetch()}}),g=(0,R.useMutation)({mutationFn:()=>(0,L.mP)(t),onSuccess:()=>{m.refetch()}}),f=(0,R.useMutation)({mutationFn:()=>(0,L.zd)(t),onSuccess:()=>{m.refetch()}}),p=(0,r.useCallback)(()=>{if(!d.name.trim())return void C.oR.error("nikename required");x.mutate({name:d.name,persona:d.persona})},[d,x]),b=(0,r.useCallback)(()=>{var e,t;u({name:(null==(e=m.data)?void 0:e.name)||"",persona:(null==(t=m.data)?void 0:t.persona)||""}),s&&s()},[m.data,s]);return(0,a.jsxs)("div",{className:(0,v.cn)("w-full bg-transparent text-white",n),...i,children:[(0,a.jsx)("div",{className:"flex flex-row justify-start",children:(0,a.jsx)("h2",{className:"text-sm font-semibold mb-4",children:o("global.chatPersona")})}),(0,a.jsxs)("div",{className:"flex flex-col bg-[#2B2D33] rounded-lg",children:[(0,a.jsxs)("div",{className:"p-3",children:[(0,a.jsx)("label",{htmlFor:"nickname",className:"block text-xs mb-2",children:o("chat.setting.nickname")}),(0,a.jsx)("input",{id:"nickname",type:"text",placeholder:o("chat.setting.nicknamePlaceholder"),className:"w-full p-2 rounded-lg text-white outline-none bg-[#424751]",value:d.name,onChange:e=>{u({...d,name:e.target.value})},disabled:m.isPending||x.isPending})]}),(0,a.jsxs)("div",{className:"p-3",children:[(0,a.jsx)("label",{htmlFor:"persona",className:"block text-xs mb-2",children:o("chat.setting.persona")}),(0,a.jsx)(M.T,{id:"persona",placeholder:o("chat.setting.personaPlaceholder"),className:"w-full p-2 rounded-lg text-white outline-none bg-[#424751] row-span-3 border-none text-sm",value:d.persona,onChange:e=>{u({...d,persona:e.target.value})},disabled:m.isPending||x.isPending,autoFocus:!1})]}),h&&(0,a.jsxs)("div",{className:"flex flex-row items-center justify-end gap-3 px-3 pb-3",children:[(0,a.jsx)("button",{type:"button",className:"rounded-full flex items-center justify-center py-1 px-4 truncate border border-white/30 hover:border-white/50 hover:bg-white/10 text-sm",onClick:b,disabled:x.isPending,children:o("global.cancel")}),(0,a.jsx)("button",{type:"button",className:"rounded-full bg-h5-block-gradient flex items-center justify-center py-1 px-4 test-sm",onClick:p,disabled:!h||x.isPending,children:x.isPending?o("global.saving"):o("global.save")})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex flex-row justify-start gap-4",children:[(0,a.jsxs)("button",{type:"button",className:"text-sm flex flex-row items-center gap-2 transition-colors py-0.5 px-2 rounded-lg text-white/50 hover:bg-white/20 hover:text-white",onClick:async()=>{await c({title:o("chat.setting.confirmDefault"),body:o("chat.setting.confirmDefaultBody"),actionButton:o("global.confirm"),cancelButton:o("global.cancel")})&&g.mutate()},disabled:g.isPending,children:[g.isPending?(0,a.jsx)(I.X,{}):(0,a.jsx)(S,{}),(0,a.jsx)("span",{children:o("global.resetToMomentDefault")})]}),(0,a.jsxs)("button",{type:"button",className:"text-sm flex flex-row items-center gap-2 transition-colors py-0.5 px-2 rounded-lg text-white/50 hover:bg-white/20 hover:text-white",onClick:async()=>{await c({title:o("chat.setting.confirmGlobal"),body:o("chat.setting.confirmGlobalBody"),actionButton:o("global.confirm"),cancelButton:o("global.cancel")})&&f.mutate()},disabled:f.isPending,children:[f.isPending?(0,a.jsx)(I.X,{}):(0,a.jsx)(_,{}),(0,a.jsx)("span",{children:o("global.changeToGlobalPersona")})]})]})]})},F=e=>{let{momentId:t,className:s,...n}=e,i=(0,l.useTranslations)("chat"),[o,c]=(0,j.lh)(),[C,A]=(0,y.fp)(j.yA),[_,S]=(0,y.fp)(j.qb),[I,M]=(0,y.fp)(j.f1),[L,P]=(0,y.fp)(p.Z),R=(0,w.A)(e=>e.modelList||[]),F=(0,w.A)(e=>e.chooseModel),T=(0,w.A)(e=>{var t;return null!=(t=e.historyLength)?t:"medium"}),E=(0,w.A)(e=>e.topNValue),z=(0,w.A)(e=>e.isAdvancedMode),B=(0,r.useCallback)(e=>{c(e)},[c]),O=(0,r.useMemo)(()=>{if(F){if(R.some(e=>"models"in e)){for(let e of R){let t=e.models.find(e=>e.model===F);if(t)return t}return}return R.find(e=>e.model===F)}},[R,F]);return(0,a.jsxs)("div",{className:(0,v.cn)("w-full text-sm scrollbar-hide",s),...n,children:[(0,a.jsx)(D,{momentId:t}),(0,a.jsxs)("div",{className:"w-full bg-transparent text-white mt-5 rounded-lg pb-6",children:[(0,a.jsx)("div",{className:"flex flex-row justify-between mb-4",children:(0,a.jsx)("h2",{className:"text-sm font-semibold",children:i("setting.chatSettings")})}),(0,a.jsxs)("div",{className:"flex flex-col bg-[#2B2D33] rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(k.default,{src:h,alt:"Full Screen Icon",width:16,height:16}),(0,a.jsx)("span",{children:i("more.fullScreen")})]}),(0,a.jsx)(f.d,{checked:o,onCheckedChange:B,className:"data-[state=checked]:bg-h5-primary data-[state=unchecked]:bg-white/50"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(k.default,{src:m,alt:"Auto Scroll Icon",width:16,height:16}),(0,a.jsx)("span",{children:i("more.autoScroll")})]}),(0,a.jsx)(f.d,{checked:C,onCheckedChange:e=>A(e),className:"data-[state=checked]:bg-h5-primary data-[state=unchecked]:bg-white/50"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:i("setting.autoPlay")})]}),(0,a.jsx)(f.d,{checked:I,onCheckedChange:e=>M(e),className:"data-[state=checked]:bg-h5-primary data-[state=unchecked]:bg-white/50"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border-gray-700/50",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(g,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:i("setting.useAnim")})]}),(0,a.jsx)(f.d,{checked:_,onCheckedChange:e=>S(e),className:"data-[state=checked]:bg-h5-primary data-[state=unchecked]:bg-white/50"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col bg-[#2B2D33] rounded-lg mt-2",children:[(0,a.jsxs)("button",{type:"button",className:"flex items-center justify-between p-3 cursor-pointer hover:bg-gray-700/30 transition-colors",onClick:()=>{P({...L,visible:!0})},children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(k.default,{src:u,alt:"Model Icon",width:16,height:16}),(0,a.jsx)("span",{children:i("setting.model")})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-gray-300",children:[(0,a.jsx)("span",{children:null==O?void 0:O.name}),(0,a.jsx)(N.A,{className:"w-4 h-4"})]})]}),(0,a.jsxs)("button",{type:"button",className:"flex items-center justify-between p-3 cursor-pointer hover:bg-gray-700/30 transition-colors",onClick:()=>{P({...L,visible:!0})},children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(k.default,{src:d,alt:"Memory Length Icon",width:16,height:16}),(0,a.jsx)("span",{children:i("setting.memoryLength")})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-gray-300",children:[(0,a.jsx)("span",{suppressHydrationWarning:!0,children:z?i("more.topNSize",{value:E}):(()=>{let e=b.ge.find(e=>e.value===T);if(e)try{return i(e.$label)}catch(t){return e.$label||T}return i("memoryDefault")})()}),(0,a.jsx)(N.A,{className:"w-4 h-4"})]})]})]})]})]})};var T=s(96147),E=s(54650),z=s(98169),B=s(1305),O=s(41887),V=s(87555),H=s(43972),q=s(2240),W=s(61281),U=s(19590),K=s(45902),Z=s(11440),$=s(23417),G=s(86005);let J={hottest:"order.hottest",latest:"order.latest"},X=e=>{let{characterId:t,characterData:s,momentId:n,className:i,listClassName:o,isMobile:c=!1,...d}=e,u=(0,l.useTranslations)("global"),m=(0,l.useTranslations)("comment"),h=(0,W.J)(),[x,g]=(0,r.useState)("latest"),f=["comments-list",t,x],{deleteDialogOpen:p,setDeleteDialogOpen:b,handleCreateSuccess:j,handleReplySuccess:w,handleLike:y,handlePin:N,handleDelete:C,confirmDelete:A}=(0,Z.K)({queryKey:f,order:x}),[_,S]=(0,r.useState)(void 0),M=(e,t,s)=>{S({commentId:e,rootId:t,content:s||""})},{data:L}=(0,P.useQuery)({queryKey:["comment-count",t],queryFn:()=>(0,U.Cj)(t)});return(0,a.jsxs)("div",{className:(0,v.cn)("h-full",i),...d,children:[(0,a.jsxs)("header",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h2",{className:"text-sm",children:(0,a.jsx)("span",{className:"text-sm font-semibold text-gray-200",children:u("comment.count",{count:L})})}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:Object.entries(J).map((e,t)=>{let[s,l]=e;return(0,a.jsxs)(r.Fragment,{children:[(0,a.jsx)("button",{type:"button",className:(0,v.cn)("text-sm text-white/50 hover:text-white",x===s&&"text-white"),onClick:()=>g(s),children:u(l)}),0===t&&(0,a.jsx)("span",{className:"text-gray-500",children:"|"})]},s)})})]}),(0,a.jsx)("div",{className:"absolute bottom-2 left-0 right-0 bg-[#1C1D1E] backdrop-blur-md z-10 mx-2 overflow-y-auto",children:(0,a.jsx)($.g,{characterId:t,momentId:n,commentId:null==_?void 0:_.commentId,rootId:null==_?void 0:_.rootId,onSuccess:e=>{(null==_?void 0:_.commentId)?(w(e,_.commentId,_.rootId),S(void 0)):j(e)},refExtra:(null==_?void 0:_.commentId)?(0,a.jsxs)("div",{className:"flex items-center justify-between w-full bg-h5-input px-4 py-1.5 rounded-t-xl",children:[(0,a.jsx)("p",{className:"text-white line-clamp-1 text-sm",children:_.content}),(0,a.jsx)("button",{type:"button",className:"text-white/60 hover:text-white",onClick:()=>S(void 0),children:(0,a.jsx)(B.g,{})})]}):null,sendExtra:e=>(0,a.jsx)("button",{type:"submit",className:"absolute bottom-[10px] right-2 size-8 rounded-full bg-h5-block-gradient disabled:opacity-50 flex items-center justify-center",disabled:e,children:e?(0,a.jsx)(I.X,{}):(0,a.jsx)(k.default,{src:E.A,alt:"send",width:32,height:32})})})}),(0,a.jsx)("div",{className:"h-[calc(100%-100px)] pb-8 overflow-y-auto",children:(0,a.jsx)(q.d,{className:"h-full",queryKey:f,queryEnabled:!!t,queryFn:async e=>{let{pageParam:s=0}=e;return(0,U.NX)({character_id:t,page:s,order:x})},select:e=>({...e,pages:e.pages.map(e=>({...e,data:(0,K.J)(e.data)}))}),renderList:e=>(0,a.jsx)("div",{className:(0,v.cn)("space-y-3",o),children:e.map((t,l)=>{var n;return(0,a.jsxs)("div",{children:[(0,a.jsx)(G.s,{isMobile:c,characterData:s,comment:t,rootId:t._id,fatherId:t._id,selfUserId:null==(n=h.detail)?void 0:n._id,onLike:y,onReply:M,onPin:N,onDelete:C,activeReplyCommentId:null==_?void 0:_.commentId,setActiveReplyCommentId:e=>S(e?{commentId:e,rootId:t._id,content:""}:void 0),characterCreatorUserId:s.user_id}),l!==e.length-1&&(0,a.jsx)("div",{className:"pl-12",children:(0,a.jsx)(H.Separator,{className:"bg-white/20 my-4"})})]},t._id)})})})}),(0,a.jsx)(V.lG,{open:p,onOpenChange:b,children:(0,a.jsxs)(V.Cf,{className:"max-w-md w-full text-white border-none bg-card-background rounded-xl p-6 z-[60]",closeClassName:"right-9 top-6",children:[(0,a.jsxs)(V.c7,{className:"mb-4",children:[(0,a.jsx)(V.L3,{className:"font-normal text-base",children:m("delete.title")}),(0,a.jsx)(V.rr,{className:"text-sm text-white/50",children:m("delete.description")})]}),(0,a.jsxs)(V.Es,{className:"flex justify-end gap-4",children:[(0,a.jsx)(z.Ay,{wrapperClassName:"h-9 cursor-pointer",onClick:()=>b(!1),className:"px-6 bg-card-background flex items-center justify-center text-sm hover:bg-card-background/80 transition-colors",as:"button",children:m("delete.cancel")}),(0,a.jsx)(O.$,{variant:"destructive",onClick:A,className:"bg-h5-block-gradient h-9 px-6 rounded-lg font-normal disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1.5",children:m("delete.confirm")})]})]})})]})};var Q=s(89657);let Y=[{id:"comment",$title:"comment.title",icon:(0,a.jsx)(i,{className:"fill-white w-6 h-6"})},{id:"moment",$title:"moments",icon:(0,a.jsx)(o,{className:"fill-white w-6 h-6"})},{id:"setting",$title:"setting",icon:(0,a.jsx)(e=>{let{className:t,...s}=e;return(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"currentColor",className:t,...s,children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"1.5",d:"M12 15c1.6569 0 3-1.3431 3-3s-1.3431-3-3-3-3 1.3431-3 3 1.3431 3 3 3Z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"1.5",d:"M2 12.8804v-1.76c0-1.04.85-1.9 1.9-1.9 1.81 0 2.55-1.28 1.64-2.85-.52-.9-.21-2.07.7-2.59l1.73-.99c.79-.47 1.81-.19 2.28.6l.11.19c.9 1.57 2.38 1.57 3.29 0l.11-.19c.47-.79 1.49-1.07 2.28-.6l1.73.99c.91.52 1.22 1.69.7 2.59-.91 1.57-.17 2.85 1.64 2.85 1.04 0 1.9.85 1.9 1.9v1.76c0 1.04-.85 1.9-1.9 1.9-1.81 0-2.55 1.28-1.64 2.85.52.91.21 2.07-.7 2.59l-1.73.99c-.79.47-1.81.19-2.28-.6l-.11-.19c-.9-1.57-2.38-1.57-3.29 0l-.11.19c-.47.79-1.49 1.07-2.28.6l-1.73-.99c-.91-.52-1.22-1.69-.7-2.59.91-1.57.17-2.85-1.64-2.85-1.05 0-1.9-.86-1.9-1.9Z"})]})},{className:"w-6 h-6"})}],ee=e=>{let{momentId:t,characterData:s,className:i,contentClassName:o,isMobile:d}=e,u=(0,l.useTranslations)("global"),[m,h]=(0,n.ab)(Q.H),x=(0,r.useMemo)(()=>Math.max(0,Y.findIndex(e=>e.id===m.tab)),[m.tab]);return(0,a.jsxs)(c.Tabs,{value:m.tab,onValueChange:e=>{("moment"===e||"comment"===e||"setting"===e)&&h({tab:e})},defaultValue:"moment",className:(0,v.cn)("items-center md:mt-2 mt-4",i),children:[(0,a.jsxs)(c.TabsList,{className:"relative w-full h-auto rounded-none bg-transparent px-0 gap-0 grid grid-cols-3 border-b border-white/20",children:[Y.map(e=>(0,a.jsxs)(c.TabsTrigger,{value:e.id,className:(0,v.cn)("relative py-2.5 w-full rounded-none font-normal data-[state=active]:text-h5-primary",e.id!==m.tab&&"md:hover:text-white"),title:u(e.$title),children:[e.icon,(0,a.jsx)("h3",{className:"sr-only",children:u(e.$title)})]},e.id)),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 h-0.5 rounded-t-lg w-1/3 bg-h5-block-gradient transition-transform duration-300 ease-out",style:{transform:"translateX(".concat(100*x,"%)")}})]}),(0,a.jsx)(c.TabsContent,{forceMount:!0,value:"comment",hidden:"comment"!==m.tab,className:(0,v.cn)("overflow-y-auto",o),children:(0,a.jsx)(X,{className:"p-4",characterId:s._id,characterData:s,momentId:t,isMobile:d})}),(0,a.jsx)(c.TabsContent,{value:"moment",hidden:"moment"!==m.tab,className:(0,v.cn)("overflow-y-auto",o),children:(0,a.jsx)(T.default,{momentId:t,className:"p-4 scrollbar-hide h-full",title:u("similarMoment"),isMobile:d},s._id)}),(0,a.jsx)(c.TabsContent,{forceMount:!0,value:"setting",hidden:"setting"!==m.tab,className:(0,v.cn)("overflow-y-auto",o),children:(0,a.jsx)(F,{className:"p-4",momentId:t})})]})}},89657:(e,t,s)=>{"use strict";s.d(t,{H:()=>a});let a={tab:(0,s(67569).M1)(["moment","comment","setting"]).withDefault("moment")}},90169:(e,t,s)=>{"use strict";s.d(t,{HeaderClose:()=>i});var a=s(53400),l=s(92380),n=s(83398),r=s(50122);let i=e=>{let{fitMenu:t=!1,onClose:s,defaultCloseBack:i=!0}=e,o=(0,n.useRouter)();return(0,a.jsx)(r.A.IconCloseNoGap,{className:(0,l.cn)("size-5 md:size-5 cursor-pointer",t&&"ml-7"),onClick:()=>{!s&&i?o.back():null==s||s()}})}},90452:(e,t,s)=>{"use strict";s.d(t,{H:()=>o,P:()=>c});var a=s(53400),l=s(92380),n=s(10190),r=s(1233),i=s(55767);let o=e=>{let t,{className:s,...o}=e,c=(0,n.A)(e=>e.modelList||[]),d=(0,n.A)(e=>e.chooseModel),[u,m]=(0,r.fp)(i.Z);if(Array.isArray(c)&&c.length>0&&"series_name"in c[0])for(let e of c){var h;let s=null==(h=e.models)?void 0:h.find(e=>e.model===d);if(s){t=s.name;break}}return t?(0,a.jsx)("button",{type:"button",className:(0,l.cn)("flex h-10 px-3 items-center justify-center rounded-lg bg-[rgba(102,112,128,0.60)] backdrop-blur-[15px] cursor-pointer text-sm truncate",s),onClick:()=>{m({visible:!u.visible})},...o,children:t}):null},c=e=>{let{icon:t,label:s,className:n,...o}=e,[c,d]=(0,r.fp)(i.Z);return(0,a.jsxs)("button",{type:"button",className:(0,l.cn)("flex flex-col items-center justify-center group",n),onClick:()=>{d({visible:!c.visible})},...o,children:[(0,a.jsx)("div",{className:"text-[28px] mb-[6px] text-white",children:t}),(0,a.jsx)("span",{className:"text-[10px] leading-[14px] text-white/80 group-hover:text-white",children:s})]})}},96147:(e,t,s)=>{"use strict";s.d(t,{default:()=>p});var a=s(53400),l=s(25878),n=s(50122),r=s(14692),i=s(75622),o=s(2885),c=s(67659),d=s(19590),u=s(92380),m=s(10190),h=s(40965),x=s(51865),g=s(16190),f=s(48276);function p(e){let{momentId:t,title:s,className:p,isMobile:b,...v}=e,j=(0,g.useTranslations)(),w=(0,m.A)(e=>{var t;return(null==(t=e.userData)?void 0:t.name)||""}),y=(0,h.useInfiniteQuery)({queryKey:["similar-moment-list",t],queryFn:e=>{let{pageParam:s}=e;return(0,d.w3)({momentId:t,page:s,page_size:14})},getNextPageParam:e=>e.nextPage,initialPageParam:0,staleTime:6e5,refetchOnWindowFocus:!1,refetchOnMount:!1,enabled:!!t}),N=(0,f.useMemo)(()=>{var e,t;return(0,x.h)(null!=(t=null==(e=y.data)?void 0:e.pages.flatMap(e=>e.data))?t:[],e=>e._id)},[y.data]);return y.isLoading?(0,a.jsx)("div",{className:"w-full flex items-center justify-center text-white transition-all duration-300 h-12 opacity-100",children:(0,a.jsx)("span",{className:"i-eos-icons-three-dots-loading text-xl md:text-2xl"})}):(0,a.jsxs)(a.Fragment,{children:[y.isRefetching&&(0,a.jsx)("div",{className:"w-full flex items-center justify-center text-white transition-all duration-300 h-12 opacity-100",children:(0,a.jsx)("span",{className:"i-eos-icons-three-dots-loading text-xl md:text-2xl"})}),N.length||y.hasNextPage?(0,a.jsxs)(c.b,{gap:8,columns:2,id:"chat-moment-similar-waterfall",className:(0,u.cn)("hidden-scrollbar",p),...v,children:[s&&(0,a.jsx)("h2",{className:"text-sm font-semibold mb-4",children:s}),(0,a.jsx)(o.A,{virtual:!1,items:N,renderItem:(e,t)=>(0,a.jsx)(i.A,{holderUserName:w,width:t.w,height:t.h,id:e._id,characterId:e.character_id,imageVersion:e.image_version,title:e.title,name:e.name,chat:e.chat,like:e.like,isLiked:e.is_liked,description:e.description},"".concat(e._id))}),y.hasNextPage?(0,a.jsx)(r.A,{loadFn:y.fetchNextPage,loadCondition:!y.isFetching&&!y.isLoading,rootId:"chat-moment-similar-waterfall",children:(0,a.jsx)("div",{className:"w-full h-16 flex items-center justify-center text-white/80",children:(0,a.jsx)(n.A.IconSpinner,{className:"text-xl md:text-2xl animate-spin"})})}):(0,a.jsx)("div",{className:"w-full h-16 flex items-center justify-center text-white/80 text-sm",children:j("global.nothingMore")})]}):(0,a.jsx)("div",{className:(0,u.cn)("w-full h-full flex items-center justify-center",p),...v,children:(0,a.jsx)(l.A,{className:"mt-0"})})]})}},96317:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a={src:"/_next/static/media/fans-icon.cfab2004.svg",height:16,width:16,blurWidth:0,blurHeight:0}},96613:(e,t,s)=>{"use strict";s.d(t,{default:()=>_});var a=s(53400),l=s(1233),n=s(48276),r=s(98025),i=s(18869),o=s(37070),c=s(41203),d=s(92380),u=s(28235),m=s(10190),h=s(38759),x=s(23785),g=s(77696),f=s(79016),p=s(90773),b=s(19590),v=s(75245),j=s(81909);async function w(e){m.A.getState().setIsSending(!0);let t=new AbortController;m.A.setState({abortController:t});let s=m.A.getState().sessionId;try{var a,l,n,r;let i=await (0,v.Y0)("/completion/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({continue_talk:!0,model:m.A.getState().chooseModel||(null==(l=m.A.getState().modelList)||null==(a=l[0])?void 0:a.model)||"",moment_id:e,session_id:s,length:null!=(r=m.A.getState().historyLength)?r:"medium",...m.A.getState().isAdvancedMode?{top_n:m.A.getState().topNValue}:{}}),signal:t.signal});m.A.setState({runId:i.headers.get("x-run-id")||""}),m.A.getState().setIsReceiving(!0);let o=null==(n=i.body)?void 0:n.getReader(),c=new TextDecoder;for(;o;){let{done:e,value:t}=await o.read();if(e)break;let s=c.decode(t,{stream:!0});(0,j.l)(s)}}catch(e){"AbortError"===e.name||console.error("Error in API call:",e)}finally{m.A.getState().setIsSending(!1),m.A.getState().setIsReceiving(!1),m.A.setState({abortController:null})}}var y=s(79896);async function N(e){m.A.getState().setIsSending(!0);let t=new AbortController;m.A.setState({abortController:t});let s=m.A.getState().sessionId,a="";try{var l,n,r,i;let o=await (0,v.Y0)("/completion/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({retalk:!0,model:m.A.getState().chooseModel||(null==(n=m.A.getState().modelList)||null==(l=n[0])?void 0:l.model)||"",moment_id:e,session_id:s,length:null!=(i=m.A.getState().historyLength)?i:"medium",...m.A.getState().isAdvancedMode?{top_n:m.A.getState().topNValue}:{}}),signal:t.signal});m.A.setState({runId:o.headers.get("x-run-id")||""}),m.A.getState().setIsReceiving(!0),m.A.setState(e=>{let t=[...e.chatData],s=(0,y.Kl)(t,e=>"ai"===e.role);return -1!==s&&(a=t[s].text,t[s]={...t[s],text:""}),{chatData:t}});let c=null==(r=o.body)?void 0:r.getReader(),d=new TextDecoder;for(;c;){let{done:e,value:t}=await c.read();if(e)break;let s=d.decode(t,{stream:!0});(0,j.l)(s,()=>{throw Error("retalk error")})}}catch(e){"retalk error"===e.message&&a&&m.A.setState(e=>{let t=[...e.chatData],s=(0,y.Kl)(t,e=>"ai"===e.role);return -1!==s&&(t[s]={...t[s],text:a}),{chatData:t}})}finally{m.A.getState().setIsSending(!1),m.A.getState().setIsReceiving(!1),m.A.setState({abortController:null})}}var k=s(16190);let C=()=>{let e=(0,k.useTranslations)(),[t,s]=(0,p.C)(),{startWaiting:a,endWaiting:l}=(0,c.gw)(),r=(0,g.SC)(),i=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];""!==e.trim()&&s(t?(0,f.dL)(e):e)},[s]),o=(0,n.useCallback)(e=>{N(e)},[]),d=(0,n.useCallback)(e=>{w(e)},[]),h=(0,n.useCallback)(async(t,s,n)=>{if(!s)return x.oR.error(e("chat.control.deleteError"));if(!await r({title:n?e("chat.control.rewindTitle"):e("chat.control.deleteTitle"),body:n?e("chat.control.rewindHint"):e("chat.control.deleteHint"),actionButton:e("global.confirm"),cancelButton:e("global.cancel")}))return;let i="";if(n){var o;i=(null==(o=m.A.getState().chatData.findLast(e=>"user"===e.role))?void 0:o.text)||""}let c="chat:delete-message:".concat(s);try{a(c),await (0,b.lQ)({sessionId:t,roundId:s}),m.A.setState(e=>({chatData:[...e.chatData.filter(e=>e.round_id!==s)]})),n&&m.A.setState({askValue:i})}catch(e){console.error(e)}finally{l(c)}},[a,l,r,e]),v=(0,n.useCallback)(async(t,s)=>{if(!s)return x.oR.error(e("chat.control.rewindError"));if(!await r({title:e("chat.control.rewindTitle"),body:e("chat.control.rewindHint"),actionButton:e("global.confirm"),cancelButton:e("global.cancel")}))return;let n="chat:rewind-message:".concat(s);try{a(n),await (0,b.jR)({sessionId:t,roundId:s}),m.A.setState(e=>{let t=e.chatData.findLastIndex(e=>e.round_id===s);return -1!==t?{chatData:e.chatData.slice(0,t+1)}:{chatData:e.chatData}})}catch(e){console.error(e)}finally{l(n)}},[a,l,r,e]),{setIsSelectMode:j,addSelected:y}=(0,u.PC)();return{handleCopy:i,handleRetalk:o,handleContinue:d,handleDelete:h,handleRewind:v,handleShare:(0,n.useCallback)(e=>{j(!0),y(e)},[j,y])}},A=e=>{let{momentId:t,name:s,characterId:x,isMobile:g,chatDesc:f,chatOpening:p}=e,b=(0,n.useRef)(null),{isWaiting:v}=(0,c.gw)(),[j]=(0,l.fp)(u.yA),w=(0,m.A)(e=>e.chatData),y=(0,n.useRef)(w.length),N=(0,n.useRef)(null),k=(0,n.useMemo)(()=>0===w.length?null:w[w.length-1],[w]),A=(0,n.useMemo)(()=>{let e=[{type:"desc",uniqueKey:"chat-desc"},{type:"opening",uniqueKey:"chat-opening"}];if(0===w.length)return e;let t=w.length-1,a=w[t].round_id;return[...e,...w.map((e,l)=>({...e,characterId:x,momentName:s,uniqueKey:"".concat(e.message_id||"","-").concat(l),isAi:"user"!==e.role,isUser:"user"===e.role,isLastItemAi:l===t&&"user"!==e.role,isLastRound:e.round_id===a}))]},[w,x,s]),{isSelectMode:_,toggleSelected:S,selected:I}=(0,u.PC)(),M=(0,m.A)(e=>e.setChatData),L=(0,m.A)(e=>e.isSending),[P]=(0,u.lh)(),[R,D]=(0,n.useState)(!0);(0,o.i)(()=>{M([])}),(0,n.useEffect)(()=>{b.current&&!v("chat-session:init")&&w.length>0&&setTimeout(()=>{var e;null==(e=b.current)||e.scrollToIndex({align:"end",index:"LAST",offset:1e3})},0)},[v("chat-session:init")]),(0,n.useEffect)(()=>{j&&b.current&&w.length>y.current&&setTimeout(()=>{var e;null==(e=b.current)||e.scrollToIndex({align:"end",behavior:"auto",index:"LAST"})},0),y.current=w.length},[w.length,j]);let F=C(),T=(0,n.useCallback)((e,s)=>{if(!s)return(0,a.jsx)("div",{className:"h-0.5"});if("type"in s)return"desc"===s.type?f:p;let l=_&&s.message_id&&I.has(s.message_id);return(0,a.jsx)(i.default,{roundId:s.round_id,memoName:s.momentName,text:s.text,character_id:s.characterId,message_id:s.message_id,isLastMessage:s.isLastItemAi,isLastRound:s.isLastRound,isLeft:s.isAi,isSending:!!s.isLastItemAi&&L,isSelectMode:_,onRetalk:()=>F.handleRetalk(t),onContinue:()=>F.handleContinue(t),onDelete:e=>F.handleDelete(s.session_id,s.round_id||"",e),onRewind:()=>F.handleRewind(s.session_id,s.round_id||""),onCopy:()=>F.handleCopy(s.text),onShare:()=>F.handleShare({idx:e,role:s.role,id:s.message_id||"",sessionId:s.session_id,roundId:s.round_id||"",createdAt:s.created_at,content:s.text}),className:(0,d.cn)("max-w-[550px] mx-auto pl-3 pr-3",l&&"bg-white/10"),isSelected:!!l,selectCheck:(0,a.jsx)(h.i,{isSelect:!!l}),onClick:()=>{_&&s.message_id&&S(s.message_id,{idx:e,id:s.message_id,content:s.text,createdAt:s.created_at,role:s.role,sessionId:s.session_id,roundId:s.round_id||""})}},s.uniqueKey)},[I,L,t,f,p,F,_,S]),E=(0,n.useRef)(0);return(0,n.useEffect)(()=>{if(N.current&&w.length>0){0===E.current&&(E.current=N.current.getBoundingClientRect().height);let e=new ResizeObserver(e=>{let t=e[0];if(t){let e=t.contentRect.height;if(Math.abs(e-E.current)>1&&R&&j&&w.length>0){var s;null==(s=b.current)||s.scrollToIndex({align:"end",behavior:"auto",index:"LAST"})}E.current=e}});return e.observe(N.current),()=>{e.disconnect()}}},[w.length,R,j,k]),(0,a.jsxs)("div",{className:(0,d.cn)("flex flex-col items-center w-full h-full mask-to-transparent-sm lg:mt-0",P?"mt-[40px]":"mt-[40dvh]"),children:[(0,a.jsx)(r.aY,{className:"w-full h-[100%] hidden-scrollbar overflow-x-hidden",ref:b,data:A,initialItemCount:A.length,itemContent:T,overscan:{main:800,reverse:800},atBottomStateChange:D,atBottomThreshold:150}),k&&(0,a.jsx)("div",{ref:N,style:{position:"absolute",visibility:"hidden",top:"-9999px",width:"100%"},children:(0,a.jsx)(i.default,{memoName:s,text:k.text,character_id:x,message_id:k.message_id,isLastMessage:"user"!==k.role,isSending:L&&"user"!==k.role,isLeft:"user"!==k.role},"shadow-".concat(k.message_id||""))})]})};A.displayName="MessageList";let _=A},97223:(e,t,s)=>{"use strict";s.d(t,{J:()=>c});var a=s(53400),l=s(48276),n=s(43221),r=s(88466),i=s(92380);let o=(0,r.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(n.b,{ref:t,className:(0,i.cn)(o(),s),...l})});c.displayName=n.b.displayName},97829:(e,t,s)=>{"use strict";s.d(t,{I:()=>i});var a=s(53400),l=s(5888),n=s(92380),r=s(4497);let i=e=>{let{isMobile:t,open:s,setOpen:i,trigger:o,title:c,children:d,showHeader:u=!0,headerExtra:m,headerClassName:h,layoutClassName:x,className:g,disable:f,hasHandle:p=!0}=e;return t?(0,a.jsxs)(l._s,{open:s&&!f,onOpenChange:e=>{f||i(e)},children:[(0,a.jsx)(l.Uz,{asChild:!0,children:o}),(0,a.jsxs)(l.zj,{className:(0,n.cn)("bg-h5-background border-none rounded-t-2xl",g,x),drawHandler:p&&(0,a.jsx)("div",{className:"mx-auto mt-3 h-[6px] w-[50px] rounded-full bg-h5-input"}),children:[(0,a.jsxs)(l.BE,{className:(0,n.cn)("text-white",!u&&"hidden"),children:[(0,a.jsxs)("div",{className:(0,n.cn)("flex items-center justify-between",h),children:[(0,a.jsx)(l.cp,{className:"text-2xl flex items-center gap-2 min-w-20 justify-start",children:(0,a.jsx)("span",{className:"i-hugeicons-arrow-left-01"})}),(0,a.jsx)(l.gk,{className:"font-normal",children:c}),(0,a.jsx)("div",{className:"flex items-center gap-2 min-w-20 justify-end",children:m})]}),(0,a.jsx)(l.I6,{className:"hidden",children:c})]}),d]})]}):(0,a.jsx)(r.A,{open:s&&!f,onOpenChange:e=>{f||i(e)},title:c,trigger:o,showHeader:u,onClose:()=>i(!1),headerExtra:m,contentClassName:g,headerClassName:h,layoutClassName:x,children:d})}}},e=>{var t=t=>e(e.s=t);e.O(0,[3265,1093,2090,2164,6190,8927,3602,9324,5978,1937,4784,1781,9124,7e3,3609,9972,734,5009,849,7569,2292,8619,9589,7824,8155,1401,9590,8891,8921,9483,7358],()=>t(41859)),_N_E=e.O()}]);